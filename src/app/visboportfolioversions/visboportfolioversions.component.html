<visbo-navbar></visbo-navbar>
<div class='well'>
  <div class="container">
    <div class='row'>
      <div class='col'>
        <h2 *ngIf="!vpActive">
          Portfolio Project List
        </h2>
        <h2 *ngIf="vpActive">
          Portfolio Project List in:
          <button class='panel-heading bg-white btn-white' (click)="gotoVPDetail(vpActive)">
            {{vpActive.name}}
          </button>
        </h2>
      </div>
      <!-- <div class='btn-group '>
        <div *ngIf="hasVPPerm(permVP.DeleteVP)" class='col-6'>
          <button *ngIf="!deleted" type="button" class="btn btn-sm btn-secondary" (click)="toggleVisboProjectVersions()">Show Deleted</button>
          <button *ngIf="deleted" type="button" class="btn btn-sm btn-secondary" (click)="toggleVisboProjectVersions()">Show Existing</button>
        </div>
      </div> -->
    </div>
    <div  *ngIf="vpfActiveIndex" class='row'>
      <label class="col-3">Portfolio Verion:</label>
      <select class="form-control col-8" name="timestamp" [(ngModel)]="vpfActiveIndex" #timestamp="ngModel" (change)="toggleVisboPortfolioVersion()" required>
        <option *ngFor="let itemVPF of visboportfolioversions; let itemIndex=index">{{visboportfolioversions.length - itemIndex}}</option>
      </select>
      <label class="col-3">Portfolio Timestamp:</label>
      <label class="col-3">{{vpfActive.timestamp | date: 'dd.MM.yyy HH:mm'}}</label>
      <div  *ngIf="vpfActive.variantName" class='row'>
        <label class="col-3">Variant:</label>
        <label class="col-3">{{vpfActive.variantName}}</label>
      </div>
    </div>
    <div *ngIf="hasVPPerm(permVP.ViewAudit)" class='row'>
      <div class='btn-group'>
        <button type="button" class="btn btn-primary ml-auto" (click)="switchChart()">{{chartButton}}</button>
      </div>
    </div>
  </div>
  <div class='container-fluid'>
    <h3 class='panel-heading'>
      Key Metrics of Portfolio Projects
    </h3>
    <div class="row">
      <div class="col-2">
        <button type="button" class="btn btn-md btn-secondary" title="Previous Period" (click)='getRefDateVersions(-1)'>Prev</button>
      </div>
      <h3 class="col-6">
        {{vpvRefDate | date: 'dd.MM.yyy'}}
      </h3>
      <div class="col-1">
        <button type="button" class="btn btn-md btn-secondary align-self-end" title="Next Period" (click)='getRefDateVersions(1)'>Next</button>
      </div>
      <select class="col-2 form-control" name="refDateInterval" [(ngModel)]="refDateInterval">
        <option>day</option>
        <option>week</option>
        <option>month</option>
        <option>quarter</option>
      </select>
    </div>
  </div>
  <div *ngIf="visbokeymetrics.length > 0">
    <div *ngIf="hasVPPerm(permVP.ViewAudit) && chart" class='container-fluid'>
      <div *ngIf="graphBubbleData && graphBubbleData.length" class="row">
        <app-bubble-chart [graphData]="graphBubbleData" [graphOptions]="graphBubbleOptions"></app-bubble-chart>
      </div>
    </div>

    <div *ngIf="!chart" class='container-fluid'>
      <div class='panel-body'>
        <table *ngIf="hasVPPerm(permVP.ViewAudit)" class='table table-hover table-sortable'>
          <!--Table head-->
          <thead>
            <tr>
              <th (click)="sortKeyMetricsTable(1)">Project</th>
              <th class="text-right" (click)="sortKeyMetricsTable(2)">Saving Cost</th>
              <th class="text-right" (click)="sortKeyMetricsTable(3)">Saving End Date</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(4)">Total Cost (Budget)</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(5)">End Date (Budget)</th>
              <th class="text-right d-none d-lg-table-cell" (click)="sortKeyMetricsTable(6)">Status</th>
            </tr>
          </thead>
          <!--Table body-->
          <tbody>
            <tr *ngFor="let vp of visbokeymetrics; let vpIndex=index" (click)='gotoClickedRow(vp)'
            data-toggle="modal" data-target="#ProjectDetail">
              <td>{{vp.name }}</td>
              <td class="text-right">{{vp.savingCostTotal | number:'1.0-0'}} %</td>
              <td class="text-right">{{vp.savingEndDate | number:'1.0-0' }} weeks</td>
              <td class="text-right">{{vp.keyMetrics.costBaseLastTotal | number:'1.0-0'}} kâ‚¬</td>
              <td class="text-right">{{vp.keyMetrics.endDateBaseLast | date :'dd.MM.yyyy'}}</td>
              <td class="text-right">{{vp.status }}</td>
            </tr>
          </tbody>
        </table>
        <table *ngIf="!hasVPPerm(permVP.ViewAudit)" class='table table-hover table-sortable'>
          <!--Table head-->
          <thead>
            <tr>
              <th (click)="sortKeyMetricsTable(1)">Project</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(7)">Timestamp</th>
            </tr>
          </thead>
          <!--Table body-->
          <tbody>
            <tr *ngFor="let vp of visbokeymetrics; let vpIndex=index" (click)='gotoClickedRow(vp)'
            data-toggle="modal" data-target="#ProjectDetail">
              <td>{{vp.name }}</td>
              <td class="text-right">{{vp.timestamp  | date :'dd.MM.yyyy'}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div *ngIf="visbokeymetrics.length == 0">
    <h3>
      No Project Versions related to {{vpvRefDate | date: 'dd.MM.yyy'}}
    </h3>
  </div>
</div>
