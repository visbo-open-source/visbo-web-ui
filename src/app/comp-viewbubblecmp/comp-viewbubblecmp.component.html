<div *ngIf="visbokeymetrics" class='well' (resized)="onResized($event)">
  <div class="row row-cols-1 row-cols-lg-2">
    <div class="col col-md-12 col-lg-6">
      <div *ngIf="metricListFiltered && metricListFiltered.length >= 2 && !getPreView()" class='container-fluid d-print-none'>
        <div class="row text-dark hidden-print">
          <div class="my-1 pl-1 col-11">
            <span>{{ 'compViewBubbleCmp.lbl.compare' | translate }} </span>
            <a class="dropdown-toggle font-weight-bold" data-toggle="dropdown" style="!important">{{this.getMetric(metricX).name}}</a>
            <div class="dropdown-menu">
              <a *ngFor="let item of metricListSorted" class="dropdown-item" (click)="changeMetric(item)">
                <div class="dropdown-item">{{ item.name }} </div>
              </a>
            </div>
            <span> {{ 'compViewBubble.lbl.planVsBase' | translate }}</span>
          </div>
        </div>
      </div>
      <div *ngIf="filter || !getPreView()" class='container-fluid text-dark'>
        <div class="my-1 row">
          <div class="ml-2" *ngIf="filterStrategicFit >= 0">
            <span> {{ 'compViewBubbleCmp.lbl.filter' | translate }}:</span>
            <input class="ml-2 col-form-control" type="text" (keyup)="filterKeyBoardEvent($event)" [(ngModel)]="filter" placeholder="Filter">
          </div>
          <span *ngIf="dropDownBU" class="dropdown ml-2 my-1 d-print-none">
            <span> {{ 'compViewBubbleCmp.lbl.bu' | translate }}: </span>
            <a class="dropdown-toggle" data-toggle="dropdown" style="!important">{{filterBU || dropDownBU[0]}}</a>
            <div class="dropdown-menu">
              <a *ngFor="let item of dropDownBU; let itemIndex = index" class="dropdown-item">
                <div class="dropdown-item" (click)="filterEventBU(itemIndex)">{{ item }}</div>
              </a>
            </div>
          </span>
          <div class="ml-2" *ngIf="filterStrategicFit >= 0">
            <span> {{ 'compViewBubbleCmp.lbl.strategicFit' | translate }} >=</span>
            <input class="ml-2 col-form-control" type="number" (change)="filterKeyBoardEvent($event)" [(ngModel)]="filterStrategicFit" min=0 max=10>
          </div>
          <div class="ml-2" *ngIf="filterRisk >= 0">
            <span> {{ 'compViewBubbleCmp.lbl.risk' | translate }} >=</span>
            <input class="ml-2 col-form-control" type="number" (change)="filterKeyBoardEvent($event)" [(ngModel)]="filterRisk" min=0 max=10>
          </div>
          <!-- <div class="ml-2">
            <button type="button" class="btn btn-md btn-light my-0 py-1" id="exportExcel" (click)='exportExcel()'>
              {{ 'compViewBubbleCmp.btn.exportExcel' | translate }}
            </button>
          </div> -->
        </div>
      </div>
    </div>

    <div *ngIf="visbokeymetrics.length > 0 && hasKMCost" class="col-sm-12 col-md-10 col-lg-6 card align-right px-0">
      <h5 class="card-header p-2">
        <strong class="mr-1"><ng-container *ngTemplateOutlet="indicator; context:{level: getLevel(estimateAtCompletion0, budgetAtCompletion0)}"></ng-container></strong>
        {{ 'compViewBubbleCmp.metric.costName' | translate }}
      </h5>
      <div class="card-body p-2">
        <div class="row">
          <div class="col col-sm-6">
            {{ 'compViewBubbleCmp.lbl.nrProjects' | translate }}
          </div>
          <div class="col col-sm-3 text-right">
            <strong class="mr-1"><ng-container *ngTemplateOutlet="indicator; context:{level: countKM0 < vpfActive[0].allItems.length ? 2 : 1}"></ng-container></strong>
            {{countKM0}} / {{vpfActive[0].allItems.length}}
          </div>
          <div class="col col-sm-3 text-right bg-light">
            <strong class="mr-1"><ng-container *ngTemplateOutlet="indicator; context:{level: countKM1 < vpfActive[1].allItems.length ? 2 : 1}"></ng-container></strong>
            {{countKM1}} / {{vpfActive[1].allItems.length}}
          </div>
        </div>
        <div class="row">
          <div class="col col-sm-6" title="{{ 'keyMetrics.longEAC' | translate }}">
            {{ 'keyMetrics.shortEAC' | translate }} ({{ 'keyMetrics.longEAC' | translate }})
          </div>
          <div class="col col-sm-3 text-right">
            <strong class="mr-1"><ng-container *ngTemplateOutlet="indicator; context:{level: getLevel(estimateAtCompletion0, budgetAtCompletion0)}"></ng-container></strong>
            {{estimateAtCompletion0 | number:'1.0-0'}} T€
          </div>
          <div class="col col-sm-3 text-right bg-light">
            <strong class="mr-1"><ng-container *ngTemplateOutlet="indicator; context:{level: getLevel(estimateAtCompletion1, budgetAtCompletion1)}"></ng-container></strong>
            {{estimateAtCompletion1 | number:'1.0-0'}} T€
          </div>
        </div>
        <div class="row">
          <div class="col col-sm-6" title="{{ 'keyMetrics.longBAC' | translate }}">
            {{ 'keyMetrics.shortBAC' | translate }} ({{ 'keyMetrics.longBAC' | translate }})
          </div>
          <div class="col col-sm-3 text-right">
            {{budgetAtCompletion0 | number:'1.0-0'}} T€
          </div>
          <div class="col col-sm-3 text-right bg-light">
            {{budgetAtCompletion1 | number:'1.0-0'}} T€
          </div>
        </div>
        <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
      </div>
    </div>
  </div>

  <div>
    <div *ngIf="chart" class='container-fluid'>
      <div *ngIf="countKM0 > 0 && graphBubbleData">
        <app-bubble-chart [graphData]="graphBubbleData" [graphOptions]="graphBubbleOptions" [parentThis]="parentThis" [language]="currentLang"></app-bubble-chart>
      </div>
    </div>

    <div *ngIf="chart==false" class='mt-3 container-fluid'>
      <div class='panel-body'>
        <table class='table table-hover table-sortable'>
          <thead>
            <tr>
              <th class="d-none d-lg-table-cell">{{ 'compViewBubbleCmp.lbl.nr' | translate }}</th>
              <th (click)="sortKeyMetricsTable(1)">{{ 'compViewBubbleCmp.lbl.project' | translate }}</th>
              <th *ngIf="hasVariant" class="d-none d-lg-table-cell" (click)="sortKeyMetricsTable(12)">{{ 'compViewBubbleCmp.lbl.variant' | translate }}</th>
              <th class="d-none d-xl-table-cell" (click)="sortKeyMetricsTable(13)">{{ 'compViewBubbleCmp.lbl.timestamp' | translate }}</th>

              <th (click)="sortKeyMetricsTable(14)">{{ 'keyMetrics.lbl.trafficLight' | translate }}</th>
              <th *ngIf="selectedMetric('ActualCost')" class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(16)">{{ 'compViewBubbleCmp.lbl.pv' | translate }}</th>
              <th *ngIf="selectedMetric('ActualCost')" class="text-right" (click)="sortKeyMetricsTable(15)">{{getMetric('ActualCost').table}}</th>
              <th *ngIf="selectedMetric('Cost')" class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(3)">{{ 'compViewBubbleCmp.lbl.bac' | translate }}</th>
              <th *ngIf="selectedMetric('Cost')" class="text-right" (click)="sortKeyMetricsTable(2)">{{getMetric('Cost').table}}</th>
              <th *ngIf="selectedMetric('CostPredict')" class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(3)">{{ 'compViewBubbleCmp.lbl.bac' | translate }}</th>
              <th *ngIf="selectedMetric('CostPredict')" class="text-right" (click)="sortKeyMetricsTable(17)">{{getMetric('CostPredict').table}}</th>

              <th *ngIf="selectedMetric('EndDate')" class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(5)">{{ 'compViewBubbleCmp.lbl.endDate' | translate }}</th>
              <th *ngIf="selectedMetric('EndDate')" class="text-right" (click)="sortKeyMetricsTable(4)">{{getMetric('EndDate').table}}</th>
              <th *ngIf="selectedMetric('Deadline')" class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(7)">{{ 'compViewBubbleCmp.lbl.deadlines' | translate }}</th>
              <th *ngIf="selectedMetric('Deadline')" class="text-right" (click)="sortKeyMetricsTable(6)">{{getMetric('Deadline').table}}</th>
              <th *ngIf="selectedMetric('DeadlineUnFinishedDelay')" class="text-right" (click)="sortKeyMetricsTable(11)">{{getMetric('DeadlineUnFinishedDelay').table}}</th>
              <th *ngIf="selectedMetric('DeadlineFinishedDelay')" class="text-right" (click)="sortKeyMetricsTable(10)">{{getMetric('DeadlineFinishedDelay').table}}</th>
              <th *ngIf="selectedMetric('Delivery')" class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(9)">{{ 'compViewBubbleCmp.lbl.deliveries' | translate }}</th>
              <th *ngIf="selectedMetric('Delivery')" class="text-right" (click)="sortKeyMetricsTable(8)">{{getMetric('Delivery').table}}</th>

              <th (click)="sortKeyMetricsTable(14)" class="bg-light">{{ 'keyMetrics.lbl.trafficLight' | translate }}</th>
              <th *ngIf="selectedMetric('ActualCost')" class="text-right d-none d-md-table-cell bg-light" (click)="sortKeyMetricsTable(16)">{{ 'compViewBubbleCmp.lbl.pv' | translate }}</th>
              <th *ngIf="selectedMetric('ActualCost')" class="text-right bg-light" (click)="sortKeyMetricsTable(15)">{{getMetric('ActualCost').table}}</th>
              <th *ngIf="selectedMetric('Cost')" class="text-right d-none d-md-table-cell bg-light" (click)="sortKeyMetricsTable(3)">{{ 'compViewBubbleCmp.lbl.bac' | translate }}</th>
              <th *ngIf="selectedMetric('Cost')" class="text-right bg-light" (click)="sortKeyMetricsTable(2)">{{getMetric('Cost').table}}</th>
              <th *ngIf="selectedMetric('CostPredict')" class="text-right d-none d-md-table-cell bg-light" (click)="sortKeyMetricsTable(3)">{{ 'compViewBubbleCmp.lbl.bac' | translate }}</th>
              <th *ngIf="selectedMetric('CostPredict')" class="text-right bg-light" (click)="sortKeyMetricsTable(17)">{{getMetric('CostPredict').table}}</th>

              <th *ngIf="selectedMetric('EndDate')" class="text-right d-none d-md-table-cell bg-light" (click)="sortKeyMetricsTable(5)">{{ 'compViewBubbleCmp.lbl.endDate' | translate }}</th>
              <th *ngIf="selectedMetric('EndDate')" class="text-right bg-light" (click)="sortKeyMetricsTable(4)">{{getMetric('EndDate').table}}</th>
              <th *ngIf="selectedMetric('Deadline')" class="text-right d-none d-md-table-cell bg-light" (click)="sortKeyMetricsTable(7)">{{ 'compViewBubbleCmp.lbl.deadlines' | translate }}</th>
              <th *ngIf="selectedMetric('Deadline')" class="text-right bg-light" (click)="sortKeyMetricsTable(6)">{{getMetric('Deadline').table}}</th>
              <th *ngIf="selectedMetric('DeadlineUnFinishedDelay')" class="text-right bg-light" (click)="sortKeyMetricsTable(11)">{{getMetric('DeadlineUnFinishedDelay').table}}</th>
              <th *ngIf="selectedMetric('DeadlineFinishedDelay')" class="text-right bg-light" (click)="sortKeyMetricsTable(10)">{{getMetric('DeadlineFinishedDelay').table}}</th>
              <th *ngIf="selectedMetric('Delivery')" class="text-right d-none d-md-table-cell bg-light" (click)="sortKeyMetricsTable(9)">{{ 'compViewBubbleCmp.lbl.deliveries' | translate }}</th>
              <th *ngIf="selectedMetric('Delivery')" class="text-right bg-light" (click)="sortKeyMetricsTable(8)">{{getMetric('Delivery').table}}</th>
            </tr>
          </thead>
          <!--Table body-->
          <tbody>
            <tr *ngFor="let vp of visbokeymetrics; let vpIndex=index" (click)='gotoClickedRow(vp.source)'
                data-toggle="modal" data-target="#ProjectDetail">
              <td class="d-none d-lg-table-cell">{{vpIndex+1}}</td>
              <td>{{vp.source.name }}</td>
              <td *ngIf="hasVariant" class="d-none d-lg-table-cell">{{vp.source.variantName}}</td>
              <td class="d-none d-xl-table-cell"  title="{{getTimestampTooltip(vp.source)}}">{{vp.source.timestamp | date :'dd.MM.yy'}}</td>
              <td title="{{vp.source.ampelErlaeuterung}}">
                <div *ngIf="vp.source.ampelStatus >= 0">
                  <ng-container *ngTemplateOutlet="trafficLight; context:{level: vp.source.ampelStatus} " ></ng-container>
                </div>
              </td>
              <td *ngIf="selectedMetric('ActualCost') && vp.source.keyMetrics" class="text-right d-none d-md-table-cell">{{(vp.source.keyMetrics.costBaseLastActual || 0) | number:'1.0-0'}} k€</td>
              <td *ngIf="selectedMetric('ActualCost') && vp.source.keyMetrics" class="text-right"
                      title="{{(vp.source.keyMetrics.costCurrentActual || 0) | number:'1.0-0'}} k€">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.source.savingCostActual, 'percentOver')} " ></ng-container>
                {{vp.source.savingCostActual*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('ActualCost') && !vp.source.keyMetrics" class="text-right d-none d-md-table-cell"></td>
              <td *ngIf="selectedMetric('ActualCost') && !vp.source.keyMetrics"></td>

              <td *ngIf="selectedMetric('Cost') && vp.source.keyMetrics" class="text-right d-none d-md-table-cell">{{vp.source.keyMetrics.costBaseLastTotal | number:'1.0-0'}} k€</td>
              <td *ngIf="selectedMetric('Cost') && vp.source.keyMetrics" class="text-right"
                      title="{{vp.source.keyMetrics.costCurrentTotal | number:'1.0-0'}} k€">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.source.savingCostTotal, 'percentOver')} " ></ng-container>
                {{vp.source.savingCostTotal*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('Cost') && !vp.source.keyMetrics" class="text-right d-none d-md-table-cell"></td>
              <td *ngIf="selectedMetric('Cost') && !vp.source.keyMetrics"></td>

              <td *ngIf="selectedMetric('CostPredict') && vp.source.keyMetrics" class="text-right d-none d-md-table-cell">{{vp.source.keyMetrics.costBaseLastTotal | number:'1.0-0'}} k€</td>
              <td *ngIf="selectedMetric('CostPredict') && vp.source.keyMetrics" class="text-right"
                      title="{{vp.source.keyMetrics.costCurrentTotalPredict | number:'1.0-0'}} k€">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.source.savingCostTotalPredict, 'percentOver')} " ></ng-container>
                {{vp.source.savingCostTotalPredict*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('CostPredict') && !vp.source.keyMetrics" class="text-right d-none d-md-table-cell"></td>
              <td *ngIf="selectedMetric('CostPredict') && !vp.source.keyMetrics"></td>

              <td *ngIf="selectedMetric('EndDate') && vp.source.keyMetrics" class="text-right d-none d-md-table-cell">{{vp.source.keyMetrics.endDateBaseLast | date :'dd.MM.yyyy'}}</td>
              <td *ngIf="selectedMetric('EndDate') && vp.source.keyMetrics" class="text-right"
                      title="{{vp.source.keyMetrics.endDateCurrent | date :'dd.MM.yyyy'}}">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.source.savingEndDate, 'delay')} " ></ng-container>
                {{vp.source.savingEndDate | number:'1.0-0' }} weeks
              </td>
              <!-- <td *ngIf="selectedMetric('EndDate') && !vp.source.keyMetrics" class="text-right d-none d-md-table-cell">{{vp.source.endDate | date :'dd.MM.yyyy'}}</td> -->
              <td *ngIf="selectedMetric('EndDate') && !vp.source.keyMetrics" class="text-right d-none d-md-table-cell"></td>
              <td *ngIf="selectedMetric('EndDate') && !vp.source.keyMetrics" class="text-right"></td>

              <td *ngIf="selectedMetric('Deadline') && vp.source.keyMetrics" class="text-right d-none d-md-table-cell">{{vp.source.keyMetrics.timeCompletionBaseLastActual | number:'1.0-0'}}</td>
              <td *ngIf="selectedMetric('Deadline') && vp.source.keyMetrics" class="text-right"
                      title="{{vp.source.keyMetrics.timeCompletionCurrentActual | number:'1.0-0'}}">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.source.timeCompletionActual, 'percentUnder')} " ></ng-container>
                {{vp.source.timeCompletionActual*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('Deadline') && !vp.source.keyMetrics" class="text-right d-none d-md-table-cell"></td>
              <td *ngIf="selectedMetric('Deadline') && !vp.source.keyMetrics" class="text-right"></td>

              <td *ngIf="selectedMetric('DeadlineUnFinishedDelay') && vp.source.keyMetrics" class="text-right">{{vp.source.keyMetrics.timeDelayUnFinished || 0 | number:'1.0-0'}} {{ 'compViewBubbleCmp.lbl.days' | translate }}</td>
              <td *ngIf="selectedMetric('DeadlineFinishedDelay') && vp.source.keyMetrics" class="text-right">{{vp.source.keyMetrics.timeDelayFinished || 0 | number:'1.0-0'}} {{ 'compViewBubbleCmp.lbl.days' | translate }}</td>
              <td *ngIf="selectedMetric('DeadlineUnFinishedDelay') && !vp.source.keyMetrics" class="text-right"></td>
              <td *ngIf="selectedMetric('DeadlineFinishedDelay') && !vp.source.keyMetrics" class="text-right"></td>

              <td *ngIf="selectedMetric('Delivery') && vp.source.keyMetrics" class="text-right d-none d-md-table-cell">{{vp.source.keyMetrics.deliverableCompletionBaseLastActual | number:'1.0-0'}}</td>
              <td *ngIf="selectedMetric('Delivery') && vp.source.keyMetrics" class="text-right"
                      title="{{vp.source.keyMetrics.deliverableCompletionCurrentActual | number:'1.0-0'}}">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.source.deliveryCompletionActual, 'percentUnder')} " ></ng-container>
                {{vp.source.deliveryCompletionActual*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('Delivery') && !vp.source.keyMetrics" class="text-right d-none d-md-table-cell"></td>
              <td *ngIf="selectedMetric('Delivery') && !vp.source.keyMetrics"></td>

              <!-- This part is the information from the second VPF List that is used for compare -->

              <td title="{{vp.compare.ampelErlaeuterung}}" class="bg-light">
                <div *ngIf="vp.compare.ampelStatus >= 0">
                  <ng-container *ngTemplateOutlet="trafficLight; context:{level: vp.compare.ampelStatus} " ></ng-container>
                </div>
              </td>
              <td *ngIf="selectedMetric('ActualCost') && vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light">{{(vp.compare.keyMetrics.costBaseLastActual || 0) | number:'1.0-0'}} k€</td>
              <td *ngIf="selectedMetric('ActualCost') && vp.compare.keyMetrics" class="text-right bg-light"
                      title="{{(vp.compare.keyMetrics.costCurrentActual || 0) | number:'1.0-0'}} k€">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.compare.savingCostActual, 'percentOver')} " ></ng-container>
                {{vp.compare.savingCostActual*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('ActualCost') && !vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light"></td>
              <td *ngIf="selectedMetric('ActualCost') && !vp.compare.keyMetrics" class="bg-light"></td>

              <td *ngIf="selectedMetric('Cost') && vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light">{{vp.compare.keyMetrics.costBaseLastTotal | number:'1.0-0'}} k€</td>
              <td *ngIf="selectedMetric('Cost') && vp.compare.keyMetrics" class="text-right bg-light"
                      title="{{vp.compare.keyMetrics.costCurrentTotal | number:'1.0-0'}} k€">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.compare.savingCostTotal, 'percentOver')} " ></ng-container>
                {{vp.compare.savingCostTotal*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('Cost') && !vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light"></td>
              <td *ngIf="selectedMetric('Cost') && !vp.compare.keyMetrics" class="text-right bg-light"></td>

              <td *ngIf="selectedMetric('CostPredict') && vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light">{{vp.compare.keyMetrics.costBaseLastTotal | number:'1.0-0'}} k€</td>
              <td *ngIf="selectedMetric('CostPredict') && vp.compare.keyMetrics" class="text-right bg-light"
                      title="{{vp.compare.keyMetrics.costCurrentTotalPredict | number:'1.0-0'}} k€">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.compare.savingCostTotalPredict, 'percentOver')} " ></ng-container>
                {{vp.compare.savingCostTotalPredict*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('CostPredict') && !vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light"></td>
              <td *ngIf="selectedMetric('CostPredict') && !vp.compare.keyMetrics" class="text-right bg-light"></td>

              <td *ngIf="selectedMetric('EndDate') && vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light">{{vp.compare.keyMetrics.endDateBaseLast | date :'dd.MM.yyyy'}}</td>
              <td *ngIf="selectedMetric('EndDate') && vp.compare.keyMetrics" class="text-right bg-light"
                      title="{{vp.compare.keyMetrics.endDateCurrent | date :'dd.MM.yyyy'}}">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.compare.savingEndDate, 'delay')} " ></ng-container>
                {{vp.compare.savingEndDate | number:'1.0-0' }} weeks
              </td>
              <td *ngIf="selectedMetric('EndDate') && !vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light"></td>
              <td *ngIf="selectedMetric('EndDate') && !vp.compare.keyMetrics" class="text-right bg-light"></td>

              <td *ngIf="selectedMetric('Deadline') && vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light">{{vp.compare.keyMetrics.timeCompletionBaseLastActual | number:'1.0-0'}}</td>
              <td *ngIf="selectedMetric('Deadline') && vp.compare.keyMetrics" class="text-right bg-light"
                      title="{{vp.compare.keyMetrics.timeCompletionCurrentActual | number:'1.0-0'}}">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.compare.timeCompletionActual, 'percentUnder')} " ></ng-container>
                {{vp.compare.timeCompletionActual*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('Deadline') && !vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light"></td>
              <td *ngIf="selectedMetric('Deadline') && !vp.compare.keyMetrics" class="text-right bg-light"></td>

              <td *ngIf="selectedMetric('DeadlineUnFinishedDelay') && vp.compare.keyMetrics" class="text-right bg-light">{{vp.compare.keyMetrics.timeDelayUnFinished || 0 | number:'1.0-0'}} {{ 'compViewBubbleCmp.lbl.days' | translate }}</td>
              <td *ngIf="selectedMetric('DeadlineFinishedDelay') && vp.compare.keyMetrics" class="text-right bg-light">{{vp.compare.keyMetrics.timeDelayFinished || 0 | number:'1.0-0'}} {{ 'compViewBubbleCmp.lbl.days' | translate }}</td>
              <td *ngIf="selectedMetric('DeadlineUnFinishedDelay') && !vp.compare.keyMetrics" class="text-right bg-light"></td>
              <td *ngIf="selectedMetric('DeadlineFinishedDelay') && !vp.compare.keyMetrics" class="text-right bg-light"></td>

              <td *ngIf="selectedMetric('Delivery') && vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light">{{vp.compare.keyMetrics.deliverableCompletionBaseLastActual | number:'1.0-0'}}</td>
              <td *ngIf="selectedMetric('Delivery') && vp.compare.keyMetrics" class="text-right bg-light"
                      title="{{vp.compare.keyMetrics.deliverableCompletionCurrentActual | number:'1.0-0'}}">
                <ng-container *ngTemplateOutlet="indicator; context:{level: calcLevel(vp.compare.deliveryCompletionActual, 'percentUnder')} " ></ng-container>
                {{vp.compare.deliveryCompletionActual*100 | number:'1.0-0'}} %
              </td>
              <td *ngIf="selectedMetric('Delivery') && !vp.compare.keyMetrics" class="text-right d-none d-md-table-cell bg-light"></td>
              <td *ngIf="selectedMetric('Delivery') && !vp.compare.keyMetrics" class="text-right bg-light"></td>

            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div *ngIf="visbokeymetrics.length == 0">
    <h3 class="d-flex justify-content-center">
      {{ 'compViewBubbleCmp.msg.noVersions' | translate }}
    </h3>
  </div>
</div>

<ng-template #cardRow let-label="label" let-title="title" let-value="value">
  <div class="row">
    <div class="col col-sm-8" title="{{title | translate}}">
      {{label | translate }}
    </div>
    <div class="col col-sm-4 text-right">
      {{value}}
    </div>
  </div>
</ng-template>

<ng-template #indicator let-level="level">
  <i class="fa" [ngClass]="{'fa-check-circle text-success': level == 1, 'fa-exclamation-triangle text-warning': level == 2, 'fa-exclamation-circle text-danger': level == 3}"></i>
</ng-template>

<ng-template #trafficLight let-level="level">
  <i class="fas fa-lightbulb" [ngClass]="{'text-secondary': level == 0, 'text-success': level == 1, 'text-warning': level == 2, 'text-danger': level == 3}"></i>
</ng-template>
