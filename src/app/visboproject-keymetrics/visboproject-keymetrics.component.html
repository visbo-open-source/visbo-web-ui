<app-usernavbar></app-usernavbar>
<div class='well'>
  <div *ngIf="vpActive" class='row'>
    <div class='col'>
      <h2 *ngIf="vpActive">
        {{ 'vpKeyMetric.title' | translate }}: <a (click)="gotoVPDetail(vpActive)">{{vpActive.name}}</a>
        <span *ngIf="dropDownIndex > 0" class="ml-1"> ({{dropDown[dropDownIndex]}})</span>
        <span *ngIf="dropDown.length > 1" class="dropdown" class="ml-2">
          <a class="dropdown-toggle" data-toggle="dropdown" style=" !important"></a>
          <div class="dropdown-menu">
            <a *ngFor="let item of dropDown" class="dropdown-item" (click)="switchVariant(item)">{{ item }}</a>
          </div>
        </span>
        <small *ngIf="vpvKeyMetricActive" data-toggle="modal" data-target="#VpvDetails" class="mx-2" title="{{ vpvKeyMetricActive.ampelErlaeuterung }}">
          <ng-container *ngTemplateOutlet="trafficLight; context:{level: vpvKeyMetricActive.ampelStatus} " ></ng-container>
        </small>
      </h2>
      <h5>{{ 'vpKeyMetric.lbl.vc' | translate }}:
        <a (click)="gotoVC(vpActive)">{{ vpActive.vc.name }}</a>
      </h5>
    </div>
  </div>
  <div class="container-fluid" *ngIf="vpvKeyMetricActive">
    <div class="row">
      <div class="col-9 btn-toolbar" style="padding: unset;">
        <button type="button" class="btn btn-md btn-light mr-1" (click)='switchCapacity(false)'>{{ 'vpKeyMetric.btn.vpKeyMetric' | translate }}</button>
        <button *ngIf="hasVPPerm(permVC.ViewAudit)" type="button" class="btn btn-md btn-light mr-1" (click)='switchCapacity(true)'>{{ 'vpKeyMetric.btn.vpCapacity' | translate }}</button>
        <button type="button" class="btn btn-md btn-light mr-1" (click)='gotoVpView()'>{{ 'vpKeyMetric.btn.vpView' | translate }}</button>
      </div>
    </div>
    <div *ngIf="viewCapacity && vpvKeyMetricActive">
      <hr>
      <app-comp-viewcapacity [vpActive]="vpActive" [vpvActive]="vpvKeyMetricActive" [combinedPerm]="combinedPerm"></app-comp-viewcapacity>
    </div>
    <form *ngIf="!viewCapacity">
      <div class="container">
        <div class="row">
          <label for="vpName" class="col-3 col-md-2">{{ 'vpKeyMetric.lbl.status' | translate }}:</label>
          <dt class="col-8">{{ vpvKeyMetricActive.timestamp | date :'dd.MM.yyyy HH:mm'}} </dt>
        </div>
        <table *ngIf="vpvKeyMetricActive" class='table table-hover table-sortable'>
          <!--Table head-->
          <thead>
            <tr>
              <th>{{ 'vpKeyMetric.lbl.keyMetric' | translate }}</th>
              <th>{{ 'vpKeyMetric.lbl.planToDate' | translate }}</th>
              <th>{{ 'vpKeyMetric.lbl.total' | translate }}</th>
              <th class="d-none d-md-table-cell">{{ 'vpKeyMetric.lbl.trend' | translate }}</th>
            </tr>
          </thead>
          <!--Table body-->
          <tbody>
            <tr *ngIf="vpvKeyMetricActive.keyMetrics.costCurrentTotal > 0">
              <td *ngIf="typeMetricChart == 'Costs' && history" (click)="gotoViewCost()" class="font-weight-bold"><a>{{ 'vpKeyMetric.lbl.metricCost' | translate }}</a></td>
              <td *ngIf="!(typeMetricChart == 'Costs' && history)" (click)="gotoViewCost()"><a>{{ 'vpKeyMetric.lbl.metricCost' | translate }}</a></td>
              <td title="{{ 'vpKeyMetric.lbl.actualCost' | translate }}" (click)="gotoViewCost()"><a>
                <ng-container *ngTemplateOutlet="indicator; context:{level: qualityCost} " ></ng-container>
                <span> {{vpvKeyMetricActive.keyMetrics.costCurrentActual |  number:'1.0-0' }} T€ ({{100 - vpvKeyMetricActive.savingCostActual | number:'1.0-0'}} %) </span>
              </a></td>
              <td title="{{ 'vpKeyMetric.lbl.totalCost' | translate }}" (click)="gotoViewCost()"><a>
                <ng-container *ngTemplateOutlet="indicator; context:{level: qualityTotalCost} " ></ng-container>
                <span> {{vpvKeyMetricActive.keyMetrics.costCurrentTotal |  number:'1.0-0' }} T€ ({{100 - vpvKeyMetricActive.savingCostTotal | number:'1.0-0'}} %) </span>
              </a></td>
              <!-- <td></td> -->
              <td><a>
                <button type="button" class="btn" (click)="switchTo('Costs')" title="{{historyButton}}">i</button>
              </a></td>
            </tr>
            <tr *ngIf="vpvKeyMetricActive.keyMetrics.endDateBaseLast != undefined">
              <td *ngIf="typeMetricChart == 'EndDate' && history" class="font-weight-bold"><a>{{ 'vpKeyMetric.lbl.metricEndDate' | translate }}</a></td>
              <td *ngIf="!(typeMetricChart == 'EndDate' && history)"><a>{{ 'vpKeyMetric.lbl.metricEndDate' | translate }}</a></td>
              <td></td>
              <td><a>
                <ng-container *ngTemplateOutlet="indicator; context:{level: qualityEndDate} " ></ng-container>
                <span class="ml-1">{{vpvKeyMetricActive.keyMetrics.endDateCurrent | date :'dd.MM.yy'}} </span>
                <span *ngIf="qualityEndDiffWeeks" class="ml-1">({{qualityEndDiffWeeks | number :'1.1-1'}} W)</span>
              </a></td>
              <td>
                <button type="button" class="btn" (click)="switchTo('EndDate')" title="{{historyButton}}">i</button>
              </td>
            </tr>
            <tr *ngIf="vpvKeyMetricActive.keyMetrics.timeCompletionCurrentTotal > 0">
              <td *ngIf="typeMetricChart == 'Deadlines' && history" (click)="gotoViewDeadline()" class="font-weight-bold"><a>{{ 'vpKeyMetric.lbl.metricDeadline' | translate }}</a></td>
              <td *ngIf="!(typeMetricChart == 'Deadlines' && history)" (click)="gotoViewDeadline()"><a>{{ 'vpKeyMetric.lbl.metricDeadline' | translate }}</a></td>
              <td (click)="gotoViewDeadline()" title="{{ 'vpKeyMetric.lbl.actualDeadline' | translate }}"><a>
                <ng-container *ngTemplateOutlet="indicator; context:{level: qualityDeadlines} " ></ng-container>
                <span> {{vpvKeyMetricActive.keyMetrics.timeCompletionCurrentActual | number:'1.0-0'}} ({{vpvKeyMetricActive.timeCompletionActual | number:'1.0-0'}} %) </span>
              </a></td>
              <td (click)="gotoViewDeadline()"><a>
                <span>{{vpvKeyMetricActive.keyMetrics.timeCompletionCurrentTotal | number:'1.0-0'}} </span>
                <span *ngIf="vpvKeyMetricActive.keyMetrics.timeCompletionCurrentTotal < vpvKeyMetricActive.keyMetrics.timeCompletionBaseLastTotal" class="text-danger">({{vpvKeyMetricActive.keyMetrics.timeCompletionBaseLastTotal - vpvKeyMetricActive.keyMetrics.timeCompletionCurrentTotal | number:'1.0-2'}} Missing)</span>
                <span *ngIf="vpvKeyMetricActive.keyMetrics.timeCompletionCurrentTotal == vpvKeyMetricActive.keyMetrics.timeCompletionBaseLastTotal" >({{ 'vpKeyMetric.lbl.inPlan' | translate }})</span>
              </a></td>
              <td>
                <button type="button" class="btn" (click)="switchTo('Deadlines')" title="{{historyButton}}">i</button>
              </td>
            </tr>
            <tr *ngIf="hasKM(vpvKeyMetricActive.keyMetrics, 'DeadlinesDelay')">
              <td *ngIf="typeMetricChart == 'DeadlinesDelay' && history" (click)="gotoViewDeadline()" class="font-weight-bold"><a>{{ 'vpKeyMetric.lbl.metricDeadlineDelay' | translate }}</a></td>
              <td *ngIf="!(typeMetricChart == 'DeadlinesDelay' && history)" (click)="gotoViewDeadline()"><a>{{ 'vpKeyMetric.lbl.metricDeadlineDelay' | translate }}</a></td>
              <td (click)="gotoViewDeadline()" title="{{ 'vpKeyMetric.lbl.finishedDeadlineDelay' | translate }}"><a>
                <ng-container *ngTemplateOutlet="indicator; context:{level: delayActualDeadlines} " ></ng-container>
                <span> {{vpvKeyMetricActive.keyMetrics.timeDelayFinished | number:'1.0-0'}} {{ 'vpKeyMetric.lbl.unitsDelay' | translate }}</span>
              </a></td>
              <td (click)="gotoViewDeadline()" title="{{ 'vpKeyMetric.lbl.unfinishedDeadlineDelay' | translate }}"><a>
                <ng-container *ngTemplateOutlet="indicator; context:{level: delayTotalDeadlines} " ></ng-container>
                <span> {{vpvKeyMetricActive.keyMetrics.timeDelayUnFinished | number:'1.0-0'}} {{ 'vpKeyMetric.lbl.unitsDelay' | translate }}</span>
              </a></td>
              <td>
                <button type="button" class="btn" (click)="switchTo('DeadlinesDelay')" title="{{historyButton}}">i</button>
              </td>
            </tr>
            <tr *ngIf="vpvKeyMetricActive.keyMetrics.deliverableCompletionCurrentTotal > 0">
              <td *ngIf="typeMetricChart == 'Deliveries' && history" (click)="gotoViewDelivery()" class="font-weight-bold"><a>{{ 'vpKeyMetric.lbl.metricDelivery' | translate }}</a></td>
              <td *ngIf="!(typeMetricChart == 'Deliveries' && history)" (click)="gotoViewDelivery()"><a>{{ 'vpKeyMetric.lbl.metricDelivery' | translate }}</a></td>
              <td (click)="gotoViewDelivery()" title="{{ 'vpKeyMetric.lbl.actualDelivery' | translate }}"><a>
                <ng-container *ngTemplateOutlet="indicator; context:{level: qualityDelivery} " ></ng-container>
                <span> {{vpvKeyMetricActive.keyMetrics.deliverableCompletionCurrentActual | number:'1.0-0'}} ({{vpvKeyMetricActive.deliveryCompletionActual | number:'1.0-0'}} %) </span>
              </a></td>
              <td (click)="gotoViewDelivery()"><a>
                <span>{{vpvKeyMetricActive.keyMetrics.deliverableCompletionCurrentTotal | number:'1.0-0'}} </span>
                <span *ngIf="vpvKeyMetricActive.keyMetrics.deliverableCompletionCurrentTotal < vpvKeyMetricActive.keyMetrics.deliverableCompletionBaseLastTotal" class="text-danger">({{vpvKeyMetricActive.keyMetrics.deliverableCompletionBaseLastTotal - vpvKeyMetricActive.keyMetrics.deliverableCompletionCurrentTotal | number:'1.0-2'}} Missing)</span>
                <span *ngIf="vpvKeyMetricActive.keyMetrics.deliverableCompletionCurrentTotal == vpvKeyMetricActive.keyMetrics.deliverableCompletionBaseLastTotal" >({{ 'vpKeyMetric.lbl.inPlan' | translate }})</span>
              </a></td>
              <td>
                <button type="button" class="btn" (click)="switchTo('Deliveries')" title="{{historyButton}}">i</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </form>
    <div *ngIf="history && !viewCapacity">
      <hr>
      <div class="btn-group row">
        <button class="mx-1" (click)="switchChart()">{{chartButton}}</button>
        <button *ngIf="!this.chart" type="button" class="mx-1" (click)="gotoVisboProjectVersions()">{{ 'vpKeyMetric.btn.allVersions' | translate }}</button>
        <h3 class="fas fa-info-circle mx-2 mt-2 text-secondary" title="{{ 'keyMetrics.lbl.showLegend' | translate }}" data-toggle="modal" data-target="#VpvLegend"></h3>
      </div>
      <div *ngIf="chart && graphDataLineChart.length > 0" class="mt-1" >
        <div *ngIf="typeMetricChart == 'Costs'">
          <app-line-chart [graphData]="graphDataLineChart" [graphOptions]="graphOptionsLineChart" [parentThis]="parentThis" [language]="currentLang"></app-line-chart>
        </div>
        <div *ngIf="typeMetricChart == 'EndDate'">
          <app-line-chart [graphData]="graphDataLineChart" [graphOptions]="graphOptionsLineChartEndDate" [parentThis]="parentThis" [language]="currentLang"></app-line-chart>
        </div>
        <div *ngIf="typeMetricChart == 'Deadlines'">
          <app-line-chart [graphData]="graphDataLineChart" [graphOptions]="graphOptionsLineChart" [parentThis]="parentThis" [language]="currentLang"></app-line-chart>
        </div>
        <div *ngIf="typeMetricChart == 'DeadlinesDelay'">
          <app-line-chart [graphData]="graphDataLineChart" [graphOptions]="graphOptionsLineChart" [parentThis]="parentThis" [language]="currentLang"></app-line-chart>
        </div>
        <div *ngIf="typeMetricChart == 'Deliveries'">
          <app-line-chart [graphData]="graphDataLineChart" [graphOptions]="graphOptionsLineChart" [parentThis]="parentThis" [language]="currentLang"></app-line-chart>
        </div>
      </div>
      <div *ngIf="!chart && graphDataLineChart.length > 0" >
        <table *ngIf="typeMetricChart == 'Costs'" class='table table-hover table-sortable'>
          <!--Table head-->
          <thead>
            <tr>
              <th (click)="sortKeyMetricsTable(1)">{{ 'keyMetrics.lbl.timeStamp' | translate }}</th>
              <th class="text-right" (click)="sortKeyMetricsTable(2)" title="{{ 'keyMetrics.longAC' | translate }}">{{ 'keyMetrics.shortAC' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(4)" title="{{ 'keyMetrics.longPV' | translate }}">{{ 'keyMetrics.relativPV' | translate }}</th>
              <th class="text-right" (click)="sortKeyMetricsTable(3)" title="{{ 'keyMetrics.longEAC' | translate }}">{{ 'keyMetrics.shortEAC' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(5)" title="{{ 'keyMetrics.longBAC' | translate }}">{{ 'keyMetrics.baselineBAC' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(6)">{{ 'keyMetrics.lbl.trafficLight' | translate }}</th>
              <th class="text-right d-none d-lg-table-cell">{{ 'keyMetrics.lbl.info' | translate }}</th>
            </tr>
          </thead>
          <!--Table body-->
          <tbody>
            <tr *ngFor="let vp of visbokeymetrics; let vpIndex=index" (click)='listSelectRow(vp)'
            data-toggle="modal" data-target="#ProjectDetail">
              <td *ngIf="vp.timestamp == vpvKeyMetricActive.timestamp" class="font-weight-bold">{{vp.timestamp | date :'dd.MM.yyyy HH:mm' }}</td>
              <td *ngIf="vp.timestamp != vpvKeyMetricActive.timestamp">{{vp.timestamp | date :'dd.MM.yyyy HH:mm' }}</td>
              <td class="text-right">{{vp.keyMetrics.costCurrentActual | number:'1.0-0'}} k€</td>
              <td class="text-right" title="{{ 'keyMetrics.shortPV' | translate }}: {{vp.keyMetrics.costBaseLastActual | number:'1.0-0'}} k€">{{100 - vp.savingCostActual | number:'1.0-0'}} %</td>
              <td class="text-right">{{vp.keyMetrics.costCurrentTotal | number:'1.0-0'}} k€</td>
              <td class="text-right" title="{{ 'keyMetrics.shortBAC' | translate }}: {{vp.keyMetrics.costBaseLastTotal | number:'1.0-0'}} k€">{{100 - vp.savingCostTotal | number:'1.0-0'}} %</td>
              <td class="text-right" title="{{ vp.ampelErlaeuterung }}">
                <ng-container *ngTemplateOutlet="trafficLight; context:{level: vp.ampelStatus} " ></ng-container>
              </td>
              <td class="text-right"><button type="button" class="btn" title="{{ 'keyMetrics.lbl.detail' | translate }}" (click)="gotoClickedRow(vp)">i</button>
              </td>
            </tr>
          </tbody>
        </table>

        <table *ngIf="typeMetricChart == 'EndDate'" class='table table-hover table-sortable'>
          <!--Table head-->
          <thead>
            <tr>
              <th (click)="sortKeyMetricsTable(1)">{{ 'keyMetrics.lbl.timeStamp' | translate }}</th>
              <th class="text-right" (click)="sortKeyMetricsTable(31)" title="{{ 'keyMetrics.longEED' | translate }}">{{ 'keyMetrics.shortEED' | translate }}</th>
              <th class="text-right" (click)="sortKeyMetricsTable(32)" title="{{ 'keyMetrics.longBED' | translate }}">{{ 'keyMetrics.shortBED' | translate }}</th>
              <th class="text-right" (click)="sortKeyMetricsTable(33)">{{ 'vpKeyMetric.lbl.savingED' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(6)">{{ 'keyMetrics.lbl.trafficLight' | translate }}</th>
          <th class="text-right d-none d-lg-table-cell">{{ 'keyMetrics.lbl.info' | translate }}</th>
            </tr>
          </thead>
          <!--Table body-->
          <tbody>
            <tr *ngFor="let vp of visbokeymetrics; let vpIndex=index" (click)='listSelectRow(vp)'
            data-toggle="modal" data-target="#ProjectDetail">
              <td *ngIf="vp.timestamp == vpvKeyMetricActive.timestamp" class="font-weight-bold">{{vp.timestamp | date :'dd.MM.yyyy HH:mm' }}</td>
              <td *ngIf="vp.timestamp != vpvKeyMetricActive.timestamp">{{vp.timestamp | date :'dd.MM.yyyy HH:mm' }}</td>
              <td class="text-right">{{vp.keyMetrics.endDateCurrent | date :'dd.MM.yyyy'}}</td>
              <td class="text-right">{{vp.keyMetrics.endDateBaseLast | date :'dd.MM.yyyy'}}</td>
              <td class="text-right">{{vp.savingEndDate | number: '1.0-1'}} W</td>
              <td class="text-right" title="{{ vp.ampelErlaeuterung }}">
                <ng-container *ngTemplateOutlet="trafficLight; context:{level: vp.ampelStatus} " ></ng-container>
              </td>
              <td class="text-right"><button type="button" class="btn" (click)="gotoClickedRow(vp)">i</button>
              </td>
            </tr>
          </tbody>
        </table>

        <table *ngIf="typeMetricChart == 'Deadlines' || typeMetricChart == 'DeadlinesDelay'" class='table table-hover table-sortable'>
          <!--Table head-->
          <thead>
            <tr>
              <th (click)="sortKeyMetricsTable(1)">{{ 'keyMetrics.lbl.timeStamp' | translate }}</th>
              <th class="text-right" (click)="sortKeyMetricsTable(10)" title="{{ 'keyMetrics.longAD' | translate }}">{{ 'keyMetrics.shortAD' | translate }}</th>
              <th class="text-right" (click)="sortKeyMetricsTable(11)" title="{{ 'keyMetrics.longPD' | translate }}">{{ 'keyMetrics.shortPD' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(12)" title="{{ 'keyMetrics.longEDC' | translate }}">{{ 'keyMetrics.shortEDC' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(12)" title="{{ 'keyMetrics.longDAC' | translate }}">{{ 'keyMetrics.shortDAC' | translate }}</th>
              <th *ngIf="hasKM(vpvKeyMetricActive.keyMetrics, 'DeadlinesDelay')" class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(13)">{{ 'keyMetrics.lbl.actualDelay' | translate }}</th>
              <th *ngIf="hasKM(vpvKeyMetricActive.keyMetrics, 'DeadlinesDelay')" class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(14)">{{ 'keyMetrics.lbl.totalDelay' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(6)">{{ 'keyMetrics.lbl.trafficLight' | translate }}</th>
          <th class="text-right d-none d-lg-table-cell">{{ 'keyMetrics.lbl.info' | translate }}</th>
            </tr>
          </thead>
          <!--Table body-->
          <tbody>
            <tr *ngFor="let vp of visbokeymetrics; let vpIndex=index" (click)='listSelectRow(vp)'
            data-toggle="modal" data-target="#ProjectDetail">
              <td *ngIf="vp.timestamp == vpvKeyMetricActive.timestamp" class="font-weight-bold">{{vp.timestamp | date :'dd.MM.yyyy HH:mm' }}</td>
              <td *ngIf="vp.timestamp != vpvKeyMetricActive.timestamp">{{vp.timestamp | date :'dd.MM.yyyy HH:mm' }}</td>
              <td class="text-right">{{vp.keyMetrics.timeCompletionCurrentActual | number :'1.0-1'}}</td>
              <td class="text-right" title="{{ 'keyMetrics.shortPD' | translate }}: {{vp.keyMetrics.timeCompletionBaseLastActual | number:'1.0-0'}}">{{vp.timeCompletionActual | number:'1.0-0'}} %</td>
              <td class="text-right">{{vp.keyMetrics.timeCompletionCurrentTotal | number:'1.0-1'}}</td>
              <td class="text-right" title="{{ 'keyMetrics.shortDAC' | translate }}: {{vp.keyMetrics.timeCompletionBaseLastTotal | number:'1.0-0'}}">{{vp.timeCompletionTotal | number:'1.0-0'}} %</td>
              <td *ngIf="hasKM(vpvKeyMetricActive.keyMetrics, 'DeadlinesDelay')" class="text-right">{{vp.keyMetrics.timeDelayFinished | number:'1.0-0'}}</td>
              <td *ngIf="hasKM(vpvKeyMetricActive.keyMetrics, 'DeadlinesDelay')" class="text-right">{{vp.keyMetrics.timeDelayUnFinished | number:'1.0-0'}}</td>
              <td class="text-right" title="{{ vp.ampelErlaeuterung }}">
                <ng-container *ngTemplateOutlet="trafficLight; context:{level: vp.ampelStatus} " ></ng-container>
              </td>
              <td class="text-right"><button type="button" class="btn" (click)="gotoClickedRow(vp)">i</button>
              </td>
            </tr>
          </tbody>
        </table>

        <table *ngIf="typeMetricChart == 'Deliveries'" class='table table-hover table-sortable'>
          <!--Table head-->
          <thead>
            <tr>
              <th (click)="sortKeyMetricsTable(1)">{{ 'keyMetrics.lbl.timeStamp' | translate }}</th>
              <th class="text-right" (click)="sortKeyMetricsTable(21)" title="{{ 'keyMetrics.longADV' | translate }}">{{ 'keyMetrics.shortADV' | translate }}</th>
              <th class="text-right" (click)="sortKeyMetricsTable(20)" title="{{ 'keyMetrics.longPDV' | translate }}">{{ 'keyMetrics.shortPDV' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(26)" title="{{ 'keyMetrics.longEDVC' | translate }}">{{ 'keyMetrics.shortEDVC' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(22)" title="{{ 'keyMetrics.longDVAC' | translate }}">{{ 'keyMetrics.shortDVAC' | translate }}</th>
              <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(6)">{{ 'keyMetrics.lbl.trafficLight' | translate }}</th>
          <th class="text-right d-none d-lg-table-cell">{{ 'keyMetrics.lbl.info' | translate }}</th>
            </tr>
          </thead>
          <!--Table body-->
          <tbody>
            <tr *ngFor="let vp of visbokeymetrics; let vpIndex=index" (click)='listSelectRow(vp)'
            data-toggle="modal" data-target="#ProjectDetail">
              <td *ngIf="vp.timestamp == vpvKeyMetricActive.timestamp" class="font-weight-bold">{{vp.timestamp | date :'dd.MM.yyyy HH:mm' }}</td>
              <td *ngIf="vp.timestamp != vpvKeyMetricActive.timestamp">{{vp.timestamp | date :'dd.MM.yyyy HH:mm' }}</td>
              <td class="text-right">{{vp.keyMetrics.deliverableCompletionCurrentActual |number :'1.0-1'}}</td>
              <td class="text-right" title="{{ 'keyMetrics.shortPDV' | translate }}: {{vp.keyMetrics.deliverableCompletionBaseLastActual | number:'1.0-0'}}">{{vp.deliveryCompletionActual | number:'1.0-0'}} %</td>
              <td class="text-right">{{vp.keyMetrics.deliverableCompletionCurrentTotal | number:'1.0-1'}}</td>
              <td class="text-right" title="{{ 'keyMetrics.shortDVAC' | translate }}: {{vp.keyMetrics.deliverableCompletionBaseLastTotal | number:'1.0-0'}}">{{vp.deliveryCompletionTotal | number:'1.0-0'}} %</td>
              <td class="text-right" title="{{ vp.ampelErlaeuterung }}">
                <ng-container *ngTemplateOutlet="trafficLight; context:{level: vp.ampelStatus} " ></ng-container>
              </td>
              <td class="text-right"><button type="button" class="btn" (click)="gotoClickedRow(vp)">i</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<ng-template #indicator let-level="level">
  <i class="fa" [ngClass]="{'fa-check-circle text-success': level == 1, 'fa-exclamation-triangle text-warning': level == 2, 'fa-exclamation-circle text-danger': level == 3}"></i>
</ng-template>

<ng-template #trafficLight let-level="level">
  <i class="fas fa-lightbulb" [ngClass]="{'text-secondary': level == 0, 'text-success': level == 1, 'text-warning': level == 2, 'text-danger': level == 3}"></i>
</ng-template>

<!-- Modal Show Project Version Info -->
<div *ngIf="vpvKeyMetricActive" class="modal fade" id="VpvDetails" tabindex="-1" role="dialog" aria-labelledby="VpvDetailsTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="VpvDetailsTitle">{{ 'vpKeyMetric.titleDetailVersion' | translate }}: {{vpvKeyMetricActive.timestamp | date :'dd.MM.yy HH:mm'}} </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form name="VpvDetailsForm">
          <table *ngIf="vpvKeyMetricActive" class='table table-hover'>
            <!--Table head-->
            <thead>
              <tr>
                <th>{{ 'vpKeyMetric.lbl.name' | translate }}</th>
                <th>{{ 'vpKeyMetric.lbl.value' | translate }}</th>
                <th>{{ 'vpKeyMetric.lbl.info' | translate }}</th>
              </tr>
            </thead>
            <!--Table body-->
            <tbody>
              <tr *ngIf="vpvKeyMetricActive.startDate">
                <td>{{ 'vpKeyMetric.lbl.startDate' | translate }}</td>
                <td>{{ vpvKeyMetricActive.startDate | date :'dd.MM.yyyy'}}</td>
                <td class="d-none d-md-table-cell"></td>
              </tr>
              <tr>
                <td>{{ 'vpKeyMetric.lbl.endDate' | translate }}</td>
                <td>
                  <span *ngIf="delayEndDate > 0" class="fas fa-exclamation-circle" style="color:red"></span>
                  <span *ngIf="delayEndDate <= 0" class="fas fa-check-circle" style="color:green"></span>
                  <span> {{ vpvKeyMetricActive.keyMetrics.endDateCurrent | date :'dd.MM.yyyy'}}</span>
                </td>
                <td class="d-none d-md-table-cell">
                  <span *ngIf="delayEndDate > 0" class="text-danger"> {{delayEndDate | number:'1.1-1'}} {{ 'vpKeyMetric.lbl.weeksDelay' | translate }}</span>
                  <span *ngIf="delayEndDate < 0" class="text-success"> {{-delayEndDate | number:'1.1-1'}} {{ 'vpKeyMetric.lbl.weeksAhead' | translate }}</span>
                  <span *ngIf="delayEndDate == 0"> {{ 'vpKeyMetric.lbl.inTime' | translate }}</span>
                </td>
              </tr>
              <tr>
                <td>{{ 'keyMetrics.lbl.trafficLight' | translate }}</td>
                <td title="{{ vpvKeyMetricActive.ampelErlaeuterung }}">
                  <ng-container *ngTemplateOutlet="trafficLight; context:{level: vpvKeyMetricActive.ampelStatus} " ></ng-container>
                </td>
                <td class="d-none d-md-table-cell" title="{{ vpvKeyMetricActive.ampelErlaeuterung }}">
                  {{ getShortText(vpvKeyMetricActive.ampelErlaeuterung, 40) }}
                </td>
              </tr>
              <tr *ngIf="vpvKeyMetricActive.leadPerson">
                <td>{{ 'vpKeyMetric.lbl.leadPerson' | translate }}</td>
                <td title="{{ vpvKeyMetricActive.leadPerson }}">
                  {{ getShortText(vpvKeyMetricActive.leadPerson, 20) }}
                </td>
                <td></td>
              </tr>
              <tr *ngIf="vpvKeyMetricActive.description">
                <td>{{ 'vpKeyMetric.lbl.description' | translate }}</td>
                <td title="{{ vpvKeyMetricActive.description }}">
                  {{ getShortText(vpvKeyMetricActive.description, 20) }}
                </td>
                <td></td>
              </tr>
              <tr *ngIf="vpvKeyMetricActive.VorlagenName">
                <td>{{ 'vpKeyMetric.lbl.template' | translate }}</td>
                <td title="{{ vpvKeyMetricActive.VorlagenName }}">
                  {{ getShortText(vpvKeyMetricActive.VorlagenName, 20) }}
                </td>
                <td></td>
              </tr>
              <tr *ngIf="vpvKeyMetricActive.businessUnit">
                <td>{{ 'vpKeyMetric.lbl.bu' | translate }}</td>
                <td title="{{ vpvKeyMetricActive.businessUnit }}">
                  {{ getShortText(vpvKeyMetricActive.businessUnit, 20) }}
                </td>
                <td></td>
              </tr>
            </tbody>
          </table>

          <div class="modal-footer align-items-end">
            <button class="btn btn-primary" data-dismiss="modal">{{ 'vpKeyMetric.btn.back' | translate }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Show Shortcut explanation -->
<div class="modal fade" id="VpvLegend" tabindex="-1" role="dialog" aria-labelledby="VpvDetailsTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <table class='table'>
          <thead>
            <tr>
              <th>{{ 'keyMetrics.lbl.shortcut' | translate }}</th>
              <th>{{ 'keyMetrics.lbl.explanation' | translate }}</th>
            </tr>
          </thead>
          <tbody *ngIf="typeMetricChart == 'Costs'">
            <tr>
              <td>{{ 'keyMetrics.shortAC' | translate }}</td>
              <td>{{ 'keyMetrics.longAC' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortPV' | translate }}</td>
              <td>{{ 'keyMetrics.longPV' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortEAC' | translate }}</td>
              <td>{{ 'keyMetrics.longEAC' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortBAC' | translate }}</td>
              <td>{{ 'keyMetrics.longBAC' | translate }}</td>
            </tr>
          </tbody>
          <tbody *ngIf="typeMetricChart == 'EndDate'">
            <tr>
              <td>{{ 'keyMetrics.shortEED' | translate }}</td>
              <td>{{ 'keyMetrics.longEED' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortBED' | translate }}</td>
              <td>{{ 'keyMetrics.longBED' | translate }}</td>
            </tr>
          </tbody>
          <tbody *ngIf="typeMetricChart == 'Deadlines'">
            <tr>
              <td>{{ 'keyMetrics.shortAD' | translate }}</td>
              <td>{{ 'keyMetrics.longAD' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortPD' | translate }}</td>
              <td>{{ 'keyMetrics.longPD' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortEDC' | translate }}</td>
              <td>{{ 'keyMetrics.longEDC' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortDAC' | translate }}</td>
              <td>{{ 'keyMetrics.longDAC' | translate }}</td>
            </tr>
          </tbody>

          <tbody *ngIf="typeMetricChart == 'DeadlinesDelay'">
            <tr>
              <td>{{ 'keyMetrics.finishedDeadline' | translate }}</td>
              <td>{{ 'keyMetrics.longFinishedDeadline' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.unfinishedDeadline' | translate }}</td>
              <td>{{ 'keyMetrics.longUnfinishedDeadline' | translate }}</td>
            </tr>
          </tbody>

          <tbody *ngIf="typeMetricChart == 'Deliveries'">
            <tr>
              <td>{{ 'keyMetrics.shortADV' | translate }}</td>
              <td>{{ 'keyMetrics.longADV' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortPDV' | translate }}</td>
              <td>{{ 'keyMetrics.longPDV' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortEDVC' | translate }}</td>
              <td>{{ 'keyMetrics.longEDVC' | translate }}</td>
            </tr>
            <tr>
              <td>{{ 'keyMetrics.shortDVAC' | translate }}</td>
              <td>{{ 'keyMetrics.longDVAC' | translate }}</td>
            </tr>
          </tbody>

        </table>
        <div class="modal-footer align-items-end">
          <button class="btn btn-primary" data-dismiss="modal">{{ 'vpKeyMetric.btn.back' | translate }}</button>
        </div>
      </div>
    </div>
  </div>
</div>
