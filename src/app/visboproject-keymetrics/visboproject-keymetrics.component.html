<app-usernavbar></app-usernavbar>
<div class='well'>
  <div *ngIf="vpActive" class='row'>
    <div class='col'>
      <h2 *ngIf="vpActive">
        {{ 'vpKeyMetric.title' | translate }}: <a (click)="gotoVPDetail(vpActive)">{{vpActive.name}}</a>
        <span *ngIf="dropDownIndex > 0" class="ml-1" title="{{dropDown[dropDownIndex].description}}"> ({{dropDown[dropDownIndex].variantName}})</span>
        <span *ngIf="dropDown.length > 1" class="dropdown" class="ml-2">
          <a class="dropdown-toggle" data-toggle="dropdown" style="!important"></a>
          <div class="dropdown-menu">
            <div *ngFor="let item of dropDown">
              <a *ngIf="!isActiveVariant(item)" class="dropdown-item" (click)="switchVariant(item.variantName)" title="{{getVariantInfo(item)}}">{{ item.name }}</a>
            </div>
          </div>
        </span>
        <a>
          <small *ngIf="vpvActive" data-toggle="modal" data-target="#VpvDetails" (click)="initCustomFields(vpActive)" class="mx-2" title="{{ vpvActive.ampelErlaeuterung }}">
          <ng-container *ngTemplateOutlet="trafficLight; context:{level: vpvActive.ampelStatus} " ></ng-container>
          </small>
        </a>
      </h2>
      <div *ngIf="dropDownIndex > 0">
        {{ dropDown[dropDownIndex].description }}
      </div>
      <h5>{{ 'vpKeyMetric.lbl.vc' | translate }}:
        <a *ngIf="hasVCPerm(permVC.View)" (click)="gotoVC(vpActive)">{{ vpActive.vc.name }}</a>
        <span *ngIf="!hasVCPerm(permVC.View)">{{ vpActive.vc.name }}</span>
      </h5>
    </div>
  </div>

  <div *ngIf="vpvActive">
    <div class="row">
      <h4 class="col-6 text-dark">
        <div>
          <div class="d-none d-lg-block" title="{{ vpvActive.timestamp | date :'dd.MM.yyyy HH:mm:ss'}}">
            {{ 'vpKeyMetric.titleVersion' | translate }}: {{ vpvActive.timestamp | date :'dd.MM.yyyy'}}
            <a *ngIf="!checkBaselineVersion(vpvActive)" title="{{ 'vpKeyMetric.lbl.newerBL' | translate }}: {{vpvBaselineNewestTS | date :'dd.MM.yyyy HH:mm'}}">
              <ng-container *ngTemplateOutlet="indicator; context:{level: vpvActive.variantName == '' ? 3 : 2} " ></ng-container>
            </a>
          </div>
          <div class="d-block d-lg-none">
            V.: {{ vpvActive.timestamp | date :'dd.MM.'}}
          </div>
        </div>
      </h4>
      <div class="col-6 d-print-none" *ngIf="!getPreView()">
        <div class="row">
          <span *ngIf="statusDirection >= 0" style="font-size: 2.2em" class="mx-1 fas fa-caret-square-left" title="Previous Period before {{refDate | date :'dd.MM.'}}" (click)='getNextVersion(-1)'></span>
          <select *ngIf="statusDirection != undefined" class="col-4 form-control d-none d-md-block" name="refDateInterval" [(ngModel)]="refDateInterval">
            <option value="day">{{ 'vpKeyMetric.lbl.day' | translate }}</option>
            <option value="week">{{ 'vpKeyMetric.lbl.week' | translate }}</option>
            <option value="month">{{ 'vpKeyMetric.lbl.month' | translate }}</option>
            <option value="quarter">{{ 'vpKeyMetric.lbl.quarter' | translate }}</option>
          </select>
          <span *ngIf="statusDirection <= 0" style="font-size: 2.2em" class="mx-1 fas fa-caret-square-right" title="Next Period after {{refDate | date :'dd.MM.'}}" (click)='getNextVersion(+1)'></span>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="vpvActive" class="container-fluid">
    <div *ngIf="!getPreView()" class="row d-print-none">
      <div class="col-9 btn-toolbar" style="padding: unset;">
        <button *ngIf="hasVPPerm(permVP.View)" type="button" class="btn btn-md btn-light mr-1" (click)="switchView('KeyMetrics')">{{ 'vpKeyMetric.btn.vpKeyMetric' | translate }}</button>
        <button *ngIf="hasVPPerm(permVP.Modify + permVP.ViewAudit) && hasOrga" type="button" class="btn btn-md btn-light mr-1" (click)="switchView('Capacity')">{{ 'vpKeyMetric.btn.vpCapacity' | translate }}</button>
        <div class="dropdown mr-1">
          <button class="btn btn-md btn-light dropdown-toggle"  data-toggle="dropdown">
            {{ 'vpKeyMetric.btn.vpView' | translate }}
            <span class="caret"></span>
          </button>
          <div class="dropdown-menu">
            <a *ngIf="hasKM(vpvActive.keyMetrics, 'Cost') && hasOrga" class="dropdown-item" (click)="switchView('Cost', false)">{{ 'vpKeyMetric.lbl.metricCost' | translate }}</a>
            <a *ngIf="hasKM(vpvActive.keyMetrics, 'Deadline')"  class="dropdown-item" (click)="switchView('Deadline', false)">{{ 'vpKeyMetric.lbl.metricDeadline' | translate }}</a>
            <a *ngIf="hasKM(vpvActive.keyMetrics, 'Delivery')"  class="dropdown-item" (click)="switchView('Delivery', false)">{{ 'vpKeyMetric.lbl.metricDelivery' | translate }}</a>
            <!-- <a class="dropdown-item text-dark" [href]="predictURL | safeUrl">Predict</a> -->
            <a class="dropdown-item" (click)="switchView('All')">{{ 'vpKeyMetric.btn.vpViewAll' | translate }}</a>
          </div>
        </div>
        <div *ngIf="dropDownAll.length > 0" class="dropdown mr-1">
          <button class="btn btn-md btn-light dropdown-toggle"  data-toggle="dropdown">
            {{ 'vpKeyMetric.btn.vpvChange' | translate }}
            <span class="caret"></span>
          </button>
          <div class="dropdown-menu">
            <!-- <a class="dropdown-item">{{ 'vpKeyMetric.btn.vpvCopy' | translate }}</a> -->
            <a class="dropdown-item" (click)="initNewVPV('Copy')" data-toggle="modal" data-target="#vpvModalCopy">{{ 'vpKeyMetric.btn.vpvCopy' | translate }}</a>
            <a *ngIf="canModify()" class="dropdown-item" (click)="initNewVPV('Move')" data-toggle="modal" data-target="#vpvModalMove">{{ 'vpKeyMetric.btn.vpvMove' | translate }}</a>
          </div>
        </div>
      </div>
    </div>
    <hr>

    <div *ngIf="currentView == 'KeyMetrics' || currentViewKM">
      <app-comp-viewkeymetrics [visboprojectversions]="visboprojectversions" [vpvid]="vpvActive._id" [combinedPerm]="combinedPerm" (switchViewChild)="switchViewParent($event)"></app-comp-viewkeymetrics>
    </div>

    <div *ngIf="currentView == 'Capacity' && vcOrga">
      <app-comp-viewcapacity [vpActive]="vpActive" [vpvActive]="vpvActive" [vcOrganisation]="vcOrga[0]" [combinedPerm]="combinedPerm"></app-comp-viewcapacity>
    </div>
    <div *ngIf="currentView == 'Cost'">
      <app-comp-viewcost [vpvActive]="vpvActive" [combinedPerm]="combinedPerm"></app-comp-viewcost>
    </div>

    <div *ngIf="currentView == 'Deadline'">
      <app-comp-viewdeadline [vpvActive]="vpvActive" [combinedPerm]="combinedPerm"></app-comp-viewdeadline>
    </div>

    <div *ngIf="currentView == 'Delivery'">
      <app-comp-viewdelivery [vpvActive]="vpvActive" [combinedPerm]="combinedPerm"></app-comp-viewdelivery>
    </div>

    <div *ngIf="currentView == 'All'">
      <div *ngIf="hasVPPerm(permVP.ViewAudit) && hasKM(vpvActive.keyMetrics, 'Cost') && hasOrga" class="card">
        <div class="card-header" id="headingOne">
          <h5 class="mb-0">
            <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
              {{ 'vpKeyMetric.lbl.metricCost' | translate }}
            </button>
          </h5>
        </div>

        <div id="collapseThree" class="collapse show" aria-labelledby="headingThree">
          <div class="card-body">
            <app-comp-viewcost [vpvActive]="vpvActive" [combinedPerm]="combinedPerm"></app-comp-viewcost>
          </div>
        </div>
      </div>
      <div *ngIf="hasKM(vpvActive.keyMetrics, 'Deadline')" class="card">
        <div class="card-header" id="headingOne">
          <h5 class="mb-0">
            <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              {{ 'vpKeyMetric.lbl.metricDeadline' | translate }}
            </button>
          </h5>
        </div>

        <div id="collapseOne" class="collapse show" aria-labelledby="headingOne">
          <div class="card-body">
            <app-comp-viewdeadline [vpvActive]="vpvActive" [combinedPerm]="combinedPerm"></app-comp-viewdeadline>
          </div>
        </div>
      </div>
      <div *ngIf="hasKM(vpvActive.keyMetrics, 'Delivery')" class="card">
        <div class="card-header" id="headingTwo">
          <h5 class="mb-0">
            <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
              {{ 'vpKeyMetric.lbl.metricDelivery' | translate }}
            </button>
          </h5>
        </div>
        <div id="collapseTwo" class="collapse show" aria-labelledby="headingTwo">
          <div class="card-body">
            <app-comp-viewdelivery [vpvActive]="vpvActive" [combinedPerm]="combinedPerm"></app-comp-viewdelivery>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<ng-template #indicator let-level="level">
  <i class="fa" [ngClass]="{'fa-check-circle text-success': level == 1, 'fa-exclamation-triangle text-warning': level == 2, 'fa-exclamation-circle text-danger': level == 3}"></i>
</ng-template>

<ng-template #trafficLight let-level="level">
  <i class="fas fa-lightbulb" [ngClass]="{'text-secondary': level == 0, 'text-success': level == 1, 'text-warning': level == 2, 'text-danger': level == 3}"></i>
</ng-template>

<ng-template #highlight let-selected="selected" let-text="text">
  <span [ngClass]="{'font-weight-bold': selected == true, 'font-weight-normal': selected == false}">{{text}}</span>
</ng-template>

<!-- Modal Show Project Version Info -->
<div *ngIf="vpvActive" class="modal fade" id="VpvDetails" tabindex="-1" role="dialog" aria-labelledby="VpvDetailsTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="VpvDetailsTitle">
          <div title="{{ vpvActive.timestamp | date :'dd.MM.yyyy HH:mm:ss'}}">
            {{ 'vpKeyMetric.titleDetailVersion' | translate }}: {{vpvActive.timestamp | date :'dd.MM.yy HH:mm'}}
          </div>
          <div *ngIf="vpvBaseline" title="{{ vpvBaseline.timestamp | date :'dd.MM.yyyy HH:mm:ss'}}">
            {{ 'vpKeyMetric.titleBaseline' | translate }}: {{ vpvBaseline.timestamp | date :'dd.MM.yy HH:mm'}}
          </div>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form name="VpvDetailsForm">
          <table *ngIf="vpvActive" class='table table-hover'>
            <!--Table head-->
            <thead>
              <tr>
                <th>{{ 'vpKeyMetric.lbl.name' | translate }}</th>
                <th>{{ 'vpKeyMetric.lbl.info' | translate }}</th>
              </tr>
            </thead>
            <!--Table body-->
            <tbody>
              <tr *ngIf="vpvActive.startDate">
                <td>{{ 'vpKeyMetric.lbl.startDate' | translate }}</td>
                <td>
                  {{ vpvActive.startDate | date :'dd.MM.yyyy'}}
                  <span *ngIf="vpvBaseline && vpvBaseline.startDate != vpvActive.startDate"> ({{ vpvBaseline.startDate | date :'dd.MM.yyyy'}}) </span>
                </td>
              </tr>
              <tr *ngIf="vpvActive.keyMetrics && vpvActive.keyMetrics.endDateCurrent">
                <td>{{ 'vpKeyMetric.lbl.endDate' | translate }}</td>
                <td>
                  {{ vpvActive.keyMetrics.endDateCurrent | date :'dd.MM.yyyy'}}
                  <span *ngIf="vpvBaseline && vpvBaseline.endDate != vpvActive.keyMetrics.endDateCurrent"> ({{ vpvBaseline.endDate | date :'dd.MM.yyyy'}}) </span>
                </td>
              </tr>
              <tr *ngIf="!(vpvActive.keyMetrics && vpvActive.keyMetrics.endDateCurrent) && vpvActive.endDate">
                <td>{{ 'vpKeyMetric.lbl.endDate' | translate }}</td>
                <td>
                  <span> {{ vpvActive.endDate | date :'dd.MM.yyyy'}}</span>
                </td>
              </tr>
              <tr *ngIf="vpvActive.Erloes">
                <td title="{{ 'keyMetrics.longRAC' | translate }}">{{ 'keyMetrics.shortRAC' | translate }}</td>
                <td>
                  {{ vpvActive.Erloes | number:'1.0-0' }} Tâ‚¬
                </td>
              </tr>
              <tr *ngIf="vpvActive.status">
                <td>{{ 'vpKeyMetric.lbl.status' | translate }}</td>
                <td title="{{ vpvActive.status }}">
                  {{ getShortText(vpvActive.status, 20) }}
                </td>
              </tr>
              <tr>
                <td>{{ 'keyMetrics.lbl.trafficLight' | translate }}</td>
                <td title="{{ vpvActive.ampelErlaeuterung }}">
                  <ng-container *ngTemplateOutlet="trafficLight; context:{level: vpvActive.ampelStatus} " ></ng-container>
                  <br>
                  {{ vpvActive.ampelErlaeuterung }}
                </td>
              </tr>
              <tr *ngIf="vpvActive.leadPerson">
                <td>{{ 'vpKeyMetric.lbl.leadPerson' | translate }}</td>
                <td title="{{ vpvActive.leadPerson }}">
                  {{ getShortText(vpvActive.leadPerson, 20) }}
                </td>
              </tr>
              <tr *ngIf="vpvActive.description">
                <td>{{ 'vpKeyMetric.lbl.description' | translate }}</td>
                <td title="{{ vpvActive.description }}">{{ getShortText(vpvActive.description, 40) }}</td>
              </tr>
              <tr *ngIf="vpvActive.VorlagenName">
                <td>{{ 'vpKeyMetric.lbl.template' | translate }}</td>
                <td title="{{ vpvActive.VorlagenName }}">
                  {{ getShortText(vpvActive.VorlagenName, 20) }}
                </td>
              </tr>
              <tr *ngIf="vpActive.customFieldString.length > 0 || vpActive.customFieldDouble.length > 0">
                <td><b>{{ 'vpKeyMetric.lbl.projectProperty' | translate }}</b></td>
                <td></td>
              </tr>
              <tr *ngIf="customBU != undefined || customVPAdd">
                <td>{{ 'customField._businessUnit' | translate }}</td>
                <td title="{{ customBU }}">
                  <a *ngIf="hasVPPerm(permVP.Modify) && dropDownBU?.length > 1" class="dropdown-toggle" data-toggle="dropdown" style="!important">{{ customBU }}</a>
                  <div class="dropdown-menu">
                    <a *ngFor="let item of dropDownBU; let itemIndex = index" class="dropdown-item">
                      <div class="dropdown-item" (click)="customBU = item; setModified()">{{ item }}</div>
                    </a>
                  </div>
                  <input id="VPBU" *ngIf="hasVPPerm(permVP.Modify) && (!dropDownBU || dropDownBU.length <= 1)" type="text" (change)="setModified()" name=customBU [(ngModel)]="customBU">
                  <label id="VPBU" *ngIf="!hasVPPerm(permVP.Modify)">{{ getShortText(customBU, 20) }} </label>
                </td>
              </tr>
              <tr *ngIf="customStrategicFit >= 0 || customVPAdd">
                <td>{{ 'customField._strategicFit' | translate }}</td>
                <td>
                  <input id="VPSF" *ngIf="hasVPPerm(permVP.Modify)" type="number" (change)="setModified()" name=customStrategicFit [(ngModel)]="customStrategicFit" min=0 max=10>
                  <label id="VPSF" *ngIf="!hasVPPerm(permVP.Modify)">{{ customStrategicFit }} </label>
                </td>
              </tr>
              <tr *ngIf="customRisk >= 0 || customVPAdd">
                <td>{{ 'customField._risk' | translate }}</td>
                <td>
                  <input id="VPRisk" *ngIf="hasVPPerm(permVP.Modify)" type="number" (change)="setModified()" name=customRisk [(ngModel)]="customRisk" min=0 max=10>
                  <label id="VPRisk" *ngIf="!hasVPPerm(permVP.Modify)">{{ customRisk }} </label>
                </td>
              </tr>
              <tr *ngFor="let item of editCustomFieldString">
                <td>{{ item.name }}</td>
                <td *ngIf="!hasVPPerm(permVP.Modify)" title="{{ item.value }}">
                  {{ getShortText(item.value, 20) }}
                </td>
                <td *ngIf="hasVPPerm(permVP.Modify)">
                  <input id="customFieldStringID" type="text" class="form-control" (change)="setModified()" name="{{ item.name }}" [(ngModel)]="item.value">
                </td>
              </tr>
              <tr *ngFor="let item of editCustomFieldDouble">
                <td>{{ item.name }}</td>
                <td *ngIf="!hasVPPerm(permVP.Modify)">{{ item.value }}</td>
                <td *ngIf="hasVPPerm(permVP.Modify)">
                  <input id="customFieldDoubleID" type="number" class="col-8 form-control" (change)="setModified()" name="{{ item.name }}" [(ngModel)]="item.value">
                </td>
              </tr>
            </tbody>
          </table>

          <div class="modal-footer align-items-end">
            <button class="btn btn-secondary" data-dismiss="modal">{{ 'vpKeyMetric.btn.back' | translate }}</button>
            <button *ngIf="checkVPCustomValues()" class="btn btn-primary" (click)="addVPCustomValues()">{{ 'vpKeyMetric.btn.add' | translate }}</button>
            <button *ngIf="customVPModified" class="btn btn-primary" data-dismiss="modal" (click)="vpUpdate()">{{ 'vpKeyMetric.btn.save' | translate }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal move start&end Date of VPV -->
<div *ngIf="vpvActive" class="modal fade" id="vpvModalMove" tabindex="-1" role="dialog" aria-labelledby="vpvModalMoveTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="vpvModalMoveTitle">{{ 'vpKeyMetric.titleVPVMove' | translate }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div *ngIf="newVPV && newVPV.variantName == 'pfv'">
          <label class="bg-warning">{{ 'vpKeyMetric.msg.changePFV' | translate }}</label>
        </div>
        <form *ngIf="newVPV" name="vpvMove" #f2="ngForm" novalidate>
          <div class="form-group">
            <label for="startDateID" class="col-4 col-form-label">{{ 'vpKeyMetric.lbl.startDate' | translate }}:</label>
            <input *ngIf="canModifyDate('startDate')" id="startDateID" type="date" class="col-6 col-form-label" name="newVPVstartDate" [ngModel]="newVPVstartDate | date:'yyyy-MM-dd'" (input)="newVPVstartDate=parseDate($event.target.value)" (change)="updateDateRange()">
            <label *ngIf="!canModifyDate('startDate')" id="startDateID" class="col-6 col-form-label">{{ newVPV.startDate | date:'dd.MM.yyyy' }}</label>
          </div>
          <div class="form-group">
            <label for="endDateID" class="col-4 col-form-label">{{ 'vpKeyMetric.lbl.endDate' | translate }}:</label>
            <input id="endDateID" type="date" class="col-6 col-form-label" name="newVPVendDate" [ngModel]="newVPVendDate | date:'yyyy-MM-dd'" (input)="newVPVendDate=parseDate($event.target.value)" (change)="updateDateRange()">
          </div>
          <div class="custom-control custom-checkbox ml-3">
              <input type="checkbox" class="custom-control-input" id="scaleCheckBox" name="scaleCheckBox" [(ngModel)]="scaleCheckBox">
              <label class="custom-control-label" for="scaleCheckBox">{{ 'vpKeyMetric.lbl.scaleCheck' | translate }}</label>
          </div>
          <div *ngIf="scaleCheckBox" class="form-group">
            <label for="scaleID" class="col-4 col-form-label">{{ 'vpKeyMetric.lbl.scaleFactor' | translate }}:</label>
            <input id="scaleID" type="number" class="col-6 col-form-label" name="scaleFactor" [(ngModel)]="scaleFactor" min="-99" (change)="updateScaleFactor()"> %
          </div>
          <div *ngIf="scaleCheckBox" class="form-group">
            <label for="scaleStartDateID" class="col-4 col-form-label">{{ 'vpKeyMetric.lbl.scaleStartDate' | translate }}:</label>
            <input id="scaleStartDateID" type="date" class="col-6 col-form-label" name="newVPVscaleStartDate" [ngModel]="newVPVscaleStartDate | date:'yyyy-MM-dd'" min="{{getScaleDate('Min') | date:'yyyy-MM-dd'}}" max="{{getScaleDate('Max') | date:'yyyy-MM-dd'}}" (input)="newVPVscaleStartDate=parseDate($event.target.value)">
          </div>

        </form>
        <div class="modal-footer align-items-end">
          <button id="vpvMoveCancel" type="button" class="btn btn-secondary mx-1" data-dismiss="modal">{{ 'vpKeyMetric.btn.back' | translate }}</button>
          <button id="vpvMoveConfirm" *ngIf="!changeStatus" type="submit" class="btn btn-primary disabled mx-1">{{ 'vpKeyMetric.btn.vpvChange' | translate }}</button>
          <button id="vpvMoveConfirm" *ngIf="changeStatus" type="submit" class="btn btn-primary mx-1" (click)="moveVPV()" data-dismiss="modal">{{ 'vpKeyMetric.btn.vpvChange' | translate }}</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal copy VPV -->
<div *ngIf="vpvActive" class="modal fade" id="vpvModalCopy" tabindex="-1" role="dialog" aria-labelledby="vpvModalCopyTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="vpvModalCopyTitle">{{ 'vpKeyMetric.titleVPVCopy' | translate }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div *ngIf="newVPVvariantName == 'pfv'">
          <label class="bg-warning">{{ 'vpKeyMetric.msg.changePFV' | translate }}</label>
        </div>
        <form *ngIf="newVPV && vpvActive" name="vpvCopy" #f3="ngForm" novalidate>
          <div class="form-group">
            <div class="form-group">
              <label for="sourceVariantID" class="col-4 col-form-label">{{ 'vpKeyMetric.lbl.source' | translate }}:</label>
              <label id="sourceVariantID" class="col-6 col-form-label">{{ getVariantName(vpvActive.variantName) }}</label>
            </div>
            <div class="form-group row ml-0">
              <label for="variantNameID" class="col-4 col-form-label">{{ 'vpKeyMetric.lbl.destination' | translate }}:</label>
              <div id="variantNameID" *ngIf="newVPVdropDown.length > 1" class="col-6 col-form-label">
                <a class="dropdown-toggle" data-toggle="dropdown" style="!important">{{getVariantName(newVPVvariantName)}}</a>
                <div class="dropdown-menu">
                  <a *ngFor="let item of newVPVdropDown; let variantIndex=index" class="dropdown-item" (click)="switchCopyVariant(variantIndex)">{{ item.name }}</a>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer align-items-end">
            <button id="vpvCopyCancel" type="button" class="btn btn-secondary mx-1" data-dismiss="modal">{{ 'vpKeyMetric.btn.back' | translate }}</button>
            <button id="vpvCopyConfirm" *ngIf="!hasVariantChange()" type="submit" class="btn btn-primary disabled mx-1">{{ 'vpKeyMetric.btn.vpvChange' | translate }}</button>
            <button id="vpvCopyConfirm" *ngIf="hasVariantChange()" type="submit" class="btn btn-primary mx-1" (click)="copyVPV()" data-dismiss="modal">{{ 'vpKeyMetric.btn.vpvChange' | translate }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<ng-template #indicator let-level="level">
  <i class="fa" [ngClass]="{'fa-check-circle text-success': level == 1, 'fa-exclamation-triangle text-warning': level == 2, 'fa-exclamation-circle text-danger': level == 3}"></i>
</ng-template>
