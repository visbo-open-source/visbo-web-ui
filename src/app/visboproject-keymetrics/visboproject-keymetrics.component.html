<visbo-navbar></visbo-navbar>
<div class='well'>
  <div class="container">
    <div class='row'>
      <div class='col'>
        <h2 *ngIf="!vpActive">
          Project Key Metrics
        </h2>
        <h2 *ngIf="vpActive">
          Project Key Metrics for:
          <button class='panel-heading bg-white btn-white' (click)="gotoVPDetail(vpActive)">
            {{vpActive.name}}
          </button>
        </h2>
      </div>
      <div class='btn-group '>
        <div *ngIf="hasVPPerm(permVP.DeleteVP)">
        <!-- <div class='col-6'> -->
            <button *ngIf="!deleted" type="button" class="btn btn-sm btn-secondary" (click)="toggleVisboProjectVersions()">Show Deleted</button>
            <button *ngIf="deleted" type="button" class="btn btn-sm btn-secondary" (click)="toggleVisboProjectVersions()">Show Existing</button>
        </div>
      </div>
    </div>
    <div *ngIf="hasVPPerm(permVP.ViewAudit)" class='pb-3 row'>
      <div class="col-4">
        <div class='btn-group'>
          <button type="button" class="btn btn-primary ml-auto" (click)="switchChart()">{{chartButton}}</button>
        </div>
      </div>
      <div class="col-8">
        <div *ngIf="chart && graphDataLineChart.length > 0" class='container-fluid'>
          <select class="col-4 form-control" id="typeMetric" name="metric" [(ngModel)]="typeMetric" (change)="changeChart();">
            <option *ngFor="let metricItem of typeMetricList">{{metricItem.name}}</option>
          </select>
        </div>
      </div>
    </div>
    <div *ngIf="chart && vpvActive">
      <form>
        <div class="row">
          <label for="vpName" class="col-3 col-md-2">Name:</label>
          <label class="col-8">{{ vpvActive.name }} from {{ vpvActive.timestamp | date :'dd.MM.yyyy hh:mm'}} </label>
        </div>
        <div class="row">
          <label for="EndDate" class="col-3 col-md-2">Project ends at:</label>
          <label class="col">{{ vpvActive.endDate || vpvActive.keyMetrics.endDateCurrent | date :'dd.MM.yyyy'}} </label>
        </div>
        <div class="row" *ngIf="vpvActive.leadPerson">
          <label for="vpvLead" class="col-3 col-md-2">Project Manager:</label>
          <label class="col">{{ vpvActive.leadPerson }} </label>
        </div>
        <div class="row" *ngIf="vpvActive.ampelStatus">
          <!-- <label class="col-3 col-md-2">Ampel:</label> -->
          <i class="px-3 col-3 col-md-2 fas fa-traffic-light"></i>
          <div class="col">
            <i *ngIf="vpvActive.ampelStatus == 1" class="fas fa-circle" style="color:green"></i>
            <i *ngIf="vpvActive.ampelStatus == 2" class="fas fa-circle" style="color:yellow"></i>
            <i *ngIf="vpvActive.ampelStatus == 3" class="fas fa-circle" style="color:red"></i>
            <label class="px-3"> {{ vpvActive.ampelErlaeuterung }}</label>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="chart && graphDataLineChart.length > 0" class='container-fluid'>
      <div *ngIf="typeMetricChart == 'Costs'" class="col">
        <app-line-chart [graphData]="graphDataLineChart" [graphOptions]="graphOptionsLineChart" [parentThis]="parentThis"></app-line-chart>
      </div>
      <div *ngIf="typeMetricChart == 'Dates'" class="col">
        <app-line-chart [graphData]="graphDataLineChart" [graphOptions]="graphOptionsLineChart" [parentThis]="parentThis"></app-line-chart>
      </div>
      <div *ngIf="typeMetricChart == 'Deliveries'" class="col">
        <app-line-chart [graphData]="graphDataLineChart" [graphOptions]="graphOptionsLineChart" [parentThis]="parentThis"></app-line-chart>
      </div>
  </div>

  <div *ngIf="!chart" class='container-fluid'>
    <div class='panel-body'>
      <table *ngIf="hasVPPerm(permVP.ViewAudit)" class='table table-hover table-sortable'>
        <!--Table head-->
        <thead>
          <tr>
            <th (click)="sortKeyMetricsTable(1)">Time Stamp</th>
            <th class="text-right" (click)="sortKeyMetricsTable(2)">Saving Cost</th>
            <th class="text-right" (click)="sortKeyMetricsTable(3)">Saving End Date</th>
            <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(4)">Total Cost (Base Line)</th>
            <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(5)">End Date (Base Line)</th>
            <th class="text-right d-none d-lg-table-cell" (click)="sortKeyMetricsTable(6)">Delivery Completion</th>
          </tr>
        </thead>
        <!--Table body-->
        <tbody>
          <tr *ngFor="let vp of visbokeymetrics; let vpIndex=index" (click)='gotoClickedRow(vp)'
          data-toggle="modal" data-target="#ProjectDetail">
            <td>{{vp.timestamp | date :'dd.MM.yyyy hh:mm' }}</td>
            <td class="text-right">{{vp.savingCostTotal | number:'1.0-0'}} %</td>
            <td class="text-right">{{vp.savingEndDate | number:'1.0-0' }} weeks</td>
            <td class="text-right">{{vp.keyMetrics.costBaseLastTotal | number:'1.0-0'}} kâ‚¬</td>
            <td class="text-right">{{vp.keyMetrics.endDateBaseLast | date :'dd.MM.yyyy'}}</td>
            <td class="text-right">{{vp.deliveryCompletionTotal | number:'1.0-0' }} %</td>
          </tr>
        </tbody>
      </table>
      <table *ngIf="!hasVPPerm(permVP.ViewAudit)" class='table table-hover table-sortable'>
        <!--Table head-->
        <thead>
          <tr>
            <th (click)="sortKeyMetricsTable(1)">Project</th>
            <th class="text-right d-none d-md-table-cell" (click)="sortKeyMetricsTable(7)">Timestamp</th>
          </tr>
        </thead>
        <!--Table body-->
        <tbody>
          <tr *ngFor="let vp of visbokeymetrics; let vpIndex=index" (click)='gotoClickedRow(vp)'
          data-toggle="modal" data-target="#ProjectDetail">
            <td>{{vp.name }}</td>
            <td class="text-right">{{vp.timestamp  | date :'dd.MM.yyyy'}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
