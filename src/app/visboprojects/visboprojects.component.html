<app-usernavbar></app-usernavbar>
<div *ngIf="visboprojects" class='well'>
  <div class='row'>
    <div class='col'>
      <h2 *ngIf="!vcActive" class='panel-heading ml-0'>
        {{ 'vp.title' | translate }}
      </h2>
      <h2 *ngIf="vcActive" class='panel-heading ml-0'>
        {{ 'vp.titleVC' | translate }}: <a (click)="gotoVCDetail(vcActive)">{{vcActive.name}}</a>
      </h2>
    </div>
    <div class='btn-group'>
      <div class="mt-3 mr-1">
        {{'vp.lbl.view' | translate}}:
      </div>
      <select class="form-control mt-2" id="ViewMode" name="viewMode" [(ngModel)]="viewMode" (change)="switchView()">
        <option *ngFor="let item of dropDownVPType" value="{{item.id}}">{{item.name}}</option>
      </select>
      <div *ngIf="vcActive && hasVCPerm(permVC.CreateVP)">
        <button id="CreateVP" type="button" class="m-2 btn btn-primary" (click)='initCreateVP()' data-toggle="modal" data-target="#VpModalCreate">{{ 'vp.btn.create' | translate }}</button>
      </div>
    </div>
    <div class='container-fluid'></div>
    <div *ngIf="viewMode == 'KeyMetrics'" class="btn-toolbar" >
        <button type="button" class="ml-2 btn btn-md btn-light" (click)='changeView("KeyMetric")'>{{ 'vp.btn.viewKeyMetrics' | translate }}</button>
        <button type="button" class="ml-2 btn btn-md btn-light" (click)='changeView("List")'>{{ 'vp.btn.viewList' | translate }}</button>
        <button *ngIf="hasVCPerm(permVC.ViewAudit + permVC.Modify) && hasOrga" type="button" class="btn btn-md btn-light ml-2" (click)='changeView("Capacity")'>{{ 'vp.btn.viewCapacity' | translate }}</button>
        <button type="button" class="ml-2 btn btn-md btn-light" (click)='changeView("ProjectBoard")'>{{ 'vp.btn.viewProjectBoard' | translate }}</button>
    </div>
  </div>
  <div *ngIf="viewMode != 'KeyMetrics'" class='panel-body'>
    <table class='table table-hover table-sortable'>
      <thead id="VPHead">
        <tr>
          <th class="d-none d-md-table-cell">{{ 'vp.lbl.nr' | translate }}</th>
          <th id="SortName" (click)="sortVPTable(1)">{{ 'vp.lbl.name' | translate }}</th>
          <th id="SortType" class="d-none d-md-table-cell" (click)="sortVPTable(5)">{{ 'vp.lbl.type' | translate }}</th>
          <th id="SortDate" class="d-none d-md-table-cell" (click)="sortVPTable(2)">{{ 'vp.lbl.modified' | translate }}</th>
          <th id="SortVersions" class="d-none d-lg-table-cell" (click)="sortVPTable(4)">{{ 'vp.lbl.versions' | translate }}</th>
          <th id="SortVC" class="d-none d-lg-table-cell" (click)="sortVPTable(3)">{{ 'vp.lbl.vc' | translate }}</th>
          <!-- <th id="SortCommitDate" class="d-none d-xl-table-cell"  *ngIf="isViewWithCommit()  && hasCommitDate()"  (click)="sortVPTable(6)">{{ 'vp.lbl.commit' | translate }}</th> -->
          <th>Info</th>
        </tr>
      </thead>

      <tbody id="VPList" *ngIf="visboprojects.length > 0">
        <tr *ngFor="let vp of visboprojects; let vpIndex=index" (click)="gotoClickedRow(vp)">
          <td class="d-none d-md-table-cell">{{vpIndex+1}}</td>
          <td id="ColName"><a>{{vp.name}}</a></td>
          <td id="ColType" class="d-none d-md-table-cell">{{getVPType(vp.vpType)}}</td>
          <td id="ColDate" class="d-none d-lg-table-cell">{{vp.updatedAt | date :'dd.MM.yyyy HH:mm'}}</td>
          <td id="ColDate" class="d-none d-md-table-cell d-lg-none">{{vp.updatedAt | date :'dd.MM.yy'}}</td>
          <td id="ColVersions" class="d-none d-lg-table-cell">{{vp.vpfCount || vp.vpvCount}}</td>
          <td id="ColVC" class="d-none d-lg-table-cell" *ngIf="vp.vc">{{vp.vc.name}}</td>
          <td id="ColVC" class="d-none d-lg-table-cell" *ngIf="!vp.vc"> </td>
          <!-- <td id="ColCommitDate" class="d-none d-xl-table-cell"*ngIf="isViewWithCommit() && hasCommitDate()" >{{getCommitDate(vp)  | date :'dd.MM.yyyy HH:mm'}}</td> -->
          <!-- <td id="ColCommitDate" class="d-none d-md-table-cell  d-lg-none" *ngIf="isViewWithCommit() && hasCommitDate" >{{getCommitDate(vp)  | date :'dd.MM.yy'}}</td> -->
          <td id="ColDetail">
            <button class="Detail" title="Detail of Visbo Project"
            (click)="gotoDetail(vp)">i</button>
          </td>
        </tr>
      </tbody>

    </table>
    <div *ngIf="visboprojects.length == 0">
      <h3 class="d-flex justify-content-center">
        {{ 'vp.msg.noVP' | translate }}
      </h3>
    </div>
  </div>
  <div *ngIf="viewMode == 'KeyMetrics'">
    <hr>
    <div *ngIf="viewCockpit == 'Capacity' && vcActive && vcOrga">
      <app-comp-viewcapacity [vcActive]="vcActive" [vcOrganisation]="vcOrga[0]" [listVP] = "visboprojects" [customize]="customize" [combinedPerm]="combinedPerm"></app-comp-viewcapacity>
    </div>
    <div *ngIf="viewCockpit == 'KeyMetrics' && visboprojectversions && vcActive">
      <app-comp-viewbubble [bubbleMode]="true" [vcActive]="vcActive" [customize]="customize" [visboprojectversions]="visboprojectversions" [combinedPerm]="combinedPerm"></app-comp-viewbubble>
    </div>
    <div *ngIf="viewCockpit == 'List' && visboprojectversions">
      <app-comp-viewbubble [bubbleMode]="false" [vcActive]="vcActive" [customize]="customize" [visboprojectversions]="visboprojectversions" [combinedPerm]="combinedPerm"></app-comp-viewbubble>
    </div>
    <div *ngIf="viewCockpit == 'ProjectBoard' && visboprojectversions">
      <app-comp-viewboard [listVPV]="visboprojectversions" [customize]="customize"></app-comp-viewboard>
    </div>
  </div>

  <!-- Modal VP Create-->
  <div *ngIf="newVP" class="modal fade" id="VpModalCreate" tabindex="-1" role="dialog" aria-labelledby="VpModalCreateTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <!-- <h5 class="modal-title" id="VpModalCenterTitlePr">{{ 'vp.titleCreatePr' | translate }}</h5> -->
          <h5 *ngIf="newVP.vpType == 0" class="modal-title" id="VpModalCenterTitlePr">{{ 'vp.titleCreatePr' | translate }}</h5>
          <h5 *ngIf="newVP.vpType == 1" class="modal-title" id="VpModalCenterTitlePf">{{ 'vp.titleCreatePf' | translate }}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form #myForm="ngForm">
            <div class="form-group" *ngIf="hasVCPerm(permVC.Modify)">
              <label for="type" class="col-form-label">{{ 'vp.lbl.type' | translate }}:</label>
              <select id="CreateVPType" class="form-control" name="vpType" [(ngModel)]="newVP.vpType">
                <option value=0>{{ 'vp.type.vpType0' | translate }}</option>
                <option value=1>{{ 'vp.type.vpType1' | translate }}</option>
                <!-- <option value=2>{{ 'vp.type.vpType2' | translate }}</option> -->
              </select>
            </div>
            <!-- Edit Name -->
            <div class="form-group">
              <label for="CreateVPName" class="col-form-label">{{ 'vp.lbl.name' | translate }}:</label>
              <input id="CreateVPName" type="text" class="form-control" name="vpName" #vpName="ngModel" [(ngModel)]="newVP.name" required minlength="2" pattern="(^[A-Za-z0-9][A-Za-z0-9:.;\s_-]*[A-Za-z0-9;.\s)]$)" >
              <div *ngIf="vpName.invalid && (vpName.dirty || vpName.touched)" class="errorInput">
                <div *ngIf="vpName.errors?.required">
                  {{ 'vp.msg.errorNameLen' | translate }}
                </div>
                <div *ngIf="vpName.errors?.pattern">
                  {{ 'vp.msg.errorNamePattern' | translate }}
                </div>
                <div *ngIf="vpName.errors?.minlength">
                  {{ 'vp.msg.errorNameLen' | translate }}
                </div>
              </div>
            </div>
            <!-- Edit Description -->
            <div class="form-group">
              <label class="col-form-label">{{ 'vp.lbl.description' | translate }}:</label>
              <textarea id="CreateVPDesc" class="form-control" name="description" [(ngModel)]="newVP.description"></textarea>
            </div>
            <!-- show only when Add Project is selected -->
            <div *ngIf="newVP.vpType == 0 && vpTemplates?.length > 0">
              <!-- Selection Template -->
              <!-- <div class="form-group" *ngIf="hasVCPerm(permVC.Modify)"> -->                
              <div class="form-group">
                <label for="type" class="col-form-label">{{ 'vp.lbl.template' | translate }}:</label>
                <select id="selectVPTemplate" class="form-control" name="vpTemplate" [(ngModel)]="newVP.templateID">
                  <option *ngFor="let template of vpTemplates" value="{{ template._id }}">{{ template.name }}</option>
                </select>
              </div>
              <div *ngIf="newVP.templateID">
                <!-- Edit Start- & End-Date -->
                <div class="form-group">
                  <div class="row">
                    <div class="col">
                      <label for="vpStart" class="col-form-label">{{ 'vp.lbl.startDate' | translate }}:</label>
                      <input id="vpStart" type="date" class="form-control" name="vpStart" #vpStart="ngModel" required [ngModel]="newVP.startDate | date:'yyyy-MM-dd'" (input)="newVP.startDate=$event.target.value" >
                      <div *ngIf="vpStart.invalid && (vpStart.dirty || vpStart.touched)" class="errorInput">
                        {{'vp.msg.errorStartDate' | translate }}
                      </div>
                      <div *ngIf="vpStart?.valid && vpEnd?.valid && datesAreInvalid()" class="errorInput">
                        {{ 'vp.msg.errorStartEnd' | translate }}
                      </div>
                    </div>
                    <div class="col">
                      <label for="vpEnd" class="col-form-label">{{ 'vp.lbl.endDate' | translate }}:</label>
                      <input id="vpEnd" type="date" class="form-control" name="vpEnd" #vpEnd="ngModel" required [ngModel]="newVP.endDate | date:'yyyy-MM-dd'" (input)="newVP.endDate=$event.target.value" >
                      <div *ngIf="vpEnd.invalid && (vpEnd.dirty || vpEnd.touched)" class="errorInput">
                        {{'vp.msg.errorEndDate' | translate }}
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Edit RAC & BAC -->
                <div class="form-group">
                  <div class="row">
                    <!-- RAC -->
                    <div class="col">
                      <label for="vpRAC" class="col-form-label">{{ 'vp.lbl.rac' | translate }}:</label>
                      <input id="vpRAC" type="number" class="form-control" min="0"  name="vpRAC" [ngModel]="newVP.rac" (input)="newVP.rac=$event.target.value" >
                    </div>
                    <!-- BAC -->
                    <div class="col">
                      <label for="vpBAC" class="col-form-label">{{ 'vp.lbl.bac' | translate }}:</label>
                      <input id="vpBAC" type="number" class="form-control" min = "0" required name="vpBAC" #vpBAC="ngModel" [ngModel]="newVP.bac" (input)="newVP.bac=$event.target.value" >
                      <div *ngIf="vpBAC.invalid && (vpBAC.dirty || vpBAC.touched)" class="errorInput">
                        {{ 'vp.msg.errorBac' | translate }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
          <div class="modal-footer align-items-end">
            <button id="ButtonBack" type="button" class="btn btn-secondary" data-dismiss="modal">{{ 'vp.btn.cancel' | translate }}</button>
            <button *ngIf="myForm.valid && (newVP.vpType != 0  || !newVP.templateID || !datesAreInvalid())" id="CreateVPConfirm" type="button" class="btn btn-primary" (click)="addproject()" data-dismiss="modal">
              {{ 'vp.btn.save' | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Select Projects for Portfolio -->
  <div class="modal fade" id="VPFListCreate" tabindex="-1" role="dialog" aria-labelledby="VPFListCreateTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="VPFListCenterTitle">{{ 'vp.titleCreateVPFList' | translate }}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
        </div>
        <div class="modal-footer align-items-end">
          <button id="ButtonVPFBack" type="button" class="btn btn-secondary" data-dismiss="modal">{{ 'vp.btn.cancel' | translate }}</button>
          <button id="CreateVPFConfirm" type="button" class="btn btn-primary" data-dismiss="modal">
            {{ 'vp.btn.save' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
